<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>swb: D:/SMWData/Source_Code/SWB/src/grid_avg.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Types&nbsp;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>D:/SMWData/Source_Code/SWB/src/grid_avg.F90</h1><a href="grid__avg_8_f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacegavg.html">00001</a> <span class="keyword">module</span> gavg
<a name="l00002"></a>00002 
<a name="l00003"></a>00003   use <span class="keywordflow">types</span>
<a name="l00004"></a>00004   use <span class="keywordflow">swb_grid</span>
<a name="l00005"></a>00005   use <span class="keywordflow">swb_stats</span>
<a name="l00006"></a>00006   use <span class="keywordflow">graph</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008   <span class="keyword">implicit none</span>
<a name="l00009"></a>00009 
<a name="l00010"></a><a class="code" href="namespacegavg.html#1dfd464b61d7919af4f3a00473c9ce76">00010</a>   <span class="keywordtype">real(kind=T_SGL) </span>:: rStartTime,rEndTime
<a name="l00011"></a><a class="code" href="namespacegavg.html#b5f98f61f685ba40d5bbb74636447dee">00011</a>   <span class="keywordtype">integer (kind=T_INT)</span>, <span class="keywordtype">parameter</span> :: iAVG_ANNUAL = 0
<a name="l00012"></a><a class="code" href="namespacegavg.html#b323c04f810f58a5099ed4627f73a2d7">00012</a>   <span class="keywordtype">integer (kind=T_INT)</span>, <span class="keywordtype">parameter</span> :: iAVG_MONTHLY = 1
<a name="l00013"></a><a class="code" href="namespacegavg.html#76bd694eb63bacaba20914bbc548ec28">00013</a>   <span class="keywordtype">integer (kind=T_INT)</span>, <span class="keywordtype">parameter</span> :: iAVG_SEASONAL = 2
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="keyword">contains</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="comment">!----------------------------------------------------------------------</span>
<a name="l00018"></a>00018 
<a name="l00019"></a><a class="code" href="namespacegavg.html#d22a07f6c95d6a30e4445c8916ff6608">00019</a> <span class="keyword">subroutine </span><a class="code" href="namespacegavg.html#d22a07f6c95d6a30e4445c8916ff6608">gavg_init</a>(sControlFile, sGridFilePrefix, &amp;
<a name="l00020"></a>00020                  iBeginYear, iEndYear, sCalcBasis)
<a name="l00021"></a>00021 
<a name="l00022"></a>00022   <span class="comment">! [ARGUMENTS]</span>
<a name="l00023"></a>00023   <span class="keywordtype">character (len=*)</span>, <span class="keywordtype">intent(in)</span> :: sControlFile
<a name="l00024"></a>00024   <span class="keywordtype">character (len=*)</span>, <span class="keywordtype">intent(in)</span> :: sGridFilePrefix
<a name="l00025"></a>00025   <span class="keywordtype">integer (kind=T_INT)</span>, <span class="keywordtype">intent(in)</span> :: iBeginYear, iEndYear
<a name="l00026"></a>00026   <span class="keywordtype">character (len=*)</span>, <span class="keywordtype">intent(in)</span> :: sCalcBasis
<a name="l00027"></a>00027   <span class="comment">! [LOCALS]</span>
<a name="l00028"></a>00028   <span class="keywordtype">type (</span>T_GENERAL_GRID<span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: input_grd      <span class="comment">! Temporary grid for I/O</span>
<a name="l00029"></a>00029   <span class="keywordtype">type (</span>T_GENERAL_GRID<span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pGrd      <span class="comment">! Grid of model cells</span>
<a name="l00030"></a>00030   <span class="keywordtype">type (</span>T_GRAPH_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">dimension(:)</span>,<span class="keywordtype">pointer</span> :: pGraph
<a name="l00031"></a>00031                                             <span class="comment">! pointer to data structure that</span>
<a name="l00032"></a>00032                                                    <span class="comment">! holds parameters for creating</span>
<a name="l00033"></a>00033                                                    <span class="comment">! DISLIN plots</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035   <span class="keywordtype">character (len=256) </span>:: sRecord                  <span class="comment">! Input file text buffer</span>
<a name="l00036"></a>00036   <span class="keywordtype">character (len=256) </span>:: sItem                    <span class="comment">! Key word read from sRecord</span>
<a name="l00037"></a>00037   <span class="keywordtype">character (len=256) </span>:: sOption                  <span class="comment">! Key word read from sRecord</span>
<a name="l00038"></a>00038   <span class="keywordtype">character (len=256) </span>:: sArgument                <span class="comment">! Key word read from sRecord</span>
<a name="l00039"></a>00039   <span class="keywordtype">character (len=256) </span>:: sDateStr, sDateStrPretty <span class="comment">! hold date and time of initiation of run</span>
<a name="l00040"></a>00040   <span class="keywordtype">character(len=256) </span>:: sBuf
<a name="l00041"></a>00041   <span class="keywordtype">integer (kind=T_INT) </span>:: iNX                     <span class="comment">! Number of cells in the x-direction</span>
<a name="l00042"></a>00042   <span class="keywordtype">integer (kind=T_INT) </span>:: iNY                     <span class="comment">! Number of cells in the y-direction</span>
<a name="l00043"></a>00043   <span class="keywordtype">integer (kind=T_INT) </span>:: iValue                  <span class="comment">! Temporary value for 'CONSTANT'</span>
<a name="l00044"></a>00044   <span class="keywordtype">integer (kind=T_INT) </span>:: iStat                   <span class="comment">! For 'iostat=' checks</span>
<a name="l00045"></a>00045   <span class="keywordtype">integer (kind=T_INT) </span>:: i,iVarNum,iTimeFrame    <span class="comment">! loop counters</span>
<a name="l00046"></a>00046   <span class="keywordtype">integer (kind=T_INT) </span>:: iCalcBasis             <span class="comment">! ANNUAL, MONTHLY or QUARTERLY avgs</span>
<a name="l00047"></a>00047   <span class="keywordtype">real (kind=T_DBL) </span>:: rX0, rY0                  <span class="comment">! Model grid extent (lower-left)</span>
<a name="l00048"></a>00048   <span class="keywordtype">real (kind=T_DBL) </span>:: rX1, rY1                  <span class="comment">! Model grid extent (upper-right)</span>
<a name="l00049"></a>00049   <span class="keywordtype">real (kind=T_SGL) </span>:: rGridCellSize             <span class="comment">! Model grid cell size</span>
<a name="l00050"></a>00050   <span class="keywordtype">real (kind=T_SGL) </span>:: rValue                    <span class="comment">! Temporary value for 'CONSTANT'</span>
<a name="l00051"></a>00051   <span class="keywordtype">type (</span>T_MODEL_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">pointer</span> :: pConfig <span class="comment">! pointer to data structure that contains</span>
<a name="l00052"></a>00052                                                    <span class="comment">! model options, flags, and other settings</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   call GetSysTimeDate(sDateStr,sDateStrPretty)
<a name="l00055"></a>00055 
<a name="l00056"></a>00056   <span class="keyword">write</span>(sBuf,FMT=<span class="stringliteral">"(A,A,A)"</span>) <span class="stringliteral">"GRID_AVG_LOGFILE_"</span>,TRIM(sDateStr),<span class="stringliteral">".txt"</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   <span class="comment">! open up the log file</span>
<a name="l00059"></a>00059   <span class="keyword">open</span>(unit=LU_LOG, file=TRIM(sBuf),iostat=iStat,&amp;
<a name="l00060"></a>00060       status=<span class="stringliteral">'REPLACE'</span>)
<a name="l00061"></a>00061   call Assert(<span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00062"></a>00062       <span class="stringliteral">"Problem opening log file file for output."</span>)
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Grid Averaging Code compiled on: "</span>// &amp;
<a name="l00065"></a>00065     TRIM(__DATE__)
<a name="l00066"></a>00066   <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Grid averaging execution started: "</span>//TRIM(sDateStrPretty)
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   <span class="keyword">ALLOCATE</span> (pConfig, STAT=iStat)
<a name="l00069"></a>00069   call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00070"></a>00070      <span class="stringliteral">"Could not allocate memory for model control data structure"</span>)
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   <span class="keyword">ALLOCATE</span> (pGraph(iNUM_VARIABLES), STAT=iStat)
<a name="l00073"></a>00073   call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00074"></a>00074      <span class="stringliteral">"Could not allocate memory for graph control data structure"</span>)
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   <span class="keyword">write</span> (UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Running "</span>,trim(sControlFile)
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   <span class="comment">! Initialize the module variables - set default program options</span>
<a name="l00079"></a>00079   pConfig%sOutputFilePrefix = <span class="stringliteral">""</span>
<a name="l00080"></a>00080   pConfig%sFutureFilePrefix = <span class="stringliteral">""</span>
<a name="l00081"></a>00081   pConfig%sTimeSeriesFilename = <span class="stringliteral">""</span>
<a name="l00082"></a>00082   pConfig%sLanduseLookupFilename = <span class="stringliteral">""</span>
<a name="l00083"></a>00083   pConfig%iOutputFormat = OUTPUT_ARC
<a name="l00084"></a>00084   pConfig%iConfigureET = CONFIG_ET_NONE
<a name="l00085"></a>00085   pConfig%iConfigureRunoff = CONFIG_RUNOFF_CURVE_NUMBER
<a name="l00086"></a>00086   pConfig%iConfigureRunoffMode = CONFIG_RUNOFF_ITERATIVE
<a name="l00087"></a>00087   pConfig%iConfigurePrecip = CONFIG_PRECIP_SINGLE_STATION
<a name="l00088"></a>00088   pConfig%iConfigureTemperature = CONFIG_TEMPERATURE_SINGLE_STATION
<a name="l00089"></a>00089   pConfig%iConfigureSMCapacity = CONFIG_SM_CAPACITY_CALCULATE
<a name="l00090"></a>00090   pConfig%iConfigureInitialAbstraction = CONFIG_SM_INIT_ABSTRACTION_TR55
<a name="l00091"></a>00091   pConfig%iConfigureMissingData = CONFIG_END_IF_MISSING_DATA
<a name="l00092"></a>00092   pConfig%sOutputFileSuffix = <span class="stringliteral">"grd"</span>
<a name="l00093"></a>00093   pConfig%iHeaderPrintInterval = 7
<a name="l00094"></a>00094   pConfig%lWriteToScreen = lTRUE
<a name="l00095"></a>00095   pConfig%lReportDaily = lTRUE
<a name="l00096"></a>00096   pConfig%iFirstYear = iBeginYear
<a name="l00097"></a>00097   pConfig%iLastYear = iEndYear
<a name="l00098"></a>00098   pConfig%iOPEN_WATER_LU = -99999
<a name="l00099"></a>00099   iVarNum = -99999
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="comment">! Attempt to open CONTROL file</span>
<a name="l00102"></a>00102   <span class="keyword">open</span> ( unit=LU_CONTROL, file=sControlFile, status=<span class="stringliteral">"OLD"</span>, iostat=iStat )
<a name="l00103"></a>00103   call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot open control file "</span> // sControlFile )
<a name="l00104"></a>00104 
<a name="l00105"></a>00105   <span class="comment">! Make sure the grids have not been initialized...</span>
<a name="l00106"></a>00106   pGrd =&gt; null()
<a name="l00107"></a>00107   input_grd =&gt; null()
<a name="l00108"></a>00108 
<a name="l00109"></a>00109   CTL_READ: <span class="keyword">do</span>
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <span class="keyword">read</span> ( unit=LU_CONTROL, fmt=<span class="stringliteral">"(a256)"</span>, iostat=iStat ) sRecord
<a name="l00112"></a>00112     <span class="keyword">if</span> ( iStat &lt; 0 ) exit     <span class="comment">! EOF mark</span>
<a name="l00113"></a>00113     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00114"></a>00114        <span class="stringliteral">"Terminating due to read error"</span> )
<a name="l00115"></a>00115     <span class="keyword">if</span> ( sRecord(1:1) == <span class="stringliteral">"#"</span> ) cycle      <span class="comment">! Ignore comment lines</span>
<a name="l00116"></a>00116     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00117"></a>00117         <span class="stringliteral">"Terminating due to read error"</span> )
<a name="l00118"></a>00118     <span class="keyword">write</span> (UNIT=LU_LOG,FMT=*) <span class="stringliteral">"&gt;&gt; "</span> // trim(sRecord)
<a name="l00119"></a>00119     flush(UNIT=LU_LOG)
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     call Chomp( sRecord, sItem )
<a name="l00122"></a>00122     call Uppercase( sItem )
<a name="l00123"></a>00123     <span class="keyword">if</span> ( sItem == <span class="stringliteral">"GRID"</span> ) <span class="keyword">then</span>
<a name="l00124"></a>00124       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Reading in grid dimensions"</span>
<a name="l00125"></a>00125       <span class="comment">! Read NX</span>
<a name="l00126"></a>00126       call Chomp ( sRecord, sItem )
<a name="l00127"></a>00127       <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) iNX
<a name="l00128"></a>00128       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Failed to read NX"</span> )
<a name="l00129"></a>00129       <span class="comment">! Read NY</span>
<a name="l00130"></a>00130       call Chomp ( sRecord, sItem )
<a name="l00131"></a>00131       <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) iNY
<a name="l00132"></a>00132       call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Failed to read NY"</span> )
<a name="l00133"></a>00133       <span class="comment">! Read lower-left</span>
<a name="l00134"></a>00134       call Chomp ( sRecord, sItem )
<a name="l00135"></a>00135       <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) rX0
<a name="l00136"></a>00136       call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Failed to read X0"</span> )
<a name="l00137"></a>00137       call Chomp ( sRecord, sItem )
<a name="l00138"></a>00138       <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) rY0
<a name="l00139"></a>00139       call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Failed to read Y0"</span> )
<a name="l00140"></a>00140       <span class="comment">! Read upper-right</span>
<a name="l00141"></a>00141       call Chomp ( sRecord, sItem )
<a name="l00142"></a>00142       <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) rX1
<a name="l00143"></a>00143       call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Failed to read X1"</span> )
<a name="l00144"></a>00144       call Chomp ( sRecord, sItem )
<a name="l00145"></a>00145       <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) rY1
<a name="l00146"></a>00146       call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Failed to read Y1"</span> )
<a name="l00147"></a>00147       <span class="comment">! read grid cell size</span>
<a name="l00148"></a>00148       call Chomp ( sRecord, sItem )
<a name="l00149"></a>00149       <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) rGridCellSize
<a name="l00150"></a>00150       call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Failed to read grid cell size"</span> )
<a name="l00151"></a>00151       <span class="comment">! Now, build the grid</span>
<a name="l00152"></a>00152       pGrd =&gt; <a class="code" href="namespaceswb__grid.html#961bb54be48e77d8d35cb822379f4e60">grid_Create</a>(iNX, iNY, rX0, rY0, rX1, rY1, T_CELL_GRID)
<a name="l00153"></a>00153       pGrd%rGridCellSize = rGridCellSize
<a name="l00154"></a>00154       flush(UNIT=LU_LOG)
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"GROWING_SEASON"</span> ) <span class="keyword">then</span>
<a name="l00157"></a>00157       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Reading growing season"</span>
<a name="l00158"></a>00158       call Chomp ( sRecord, sArgument )
<a name="l00159"></a>00159       <span class="keyword">read</span> ( sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00160"></a>00160       pConfig%iDayOfFirstFrost = INT(rValue,kind=T_INT)
<a name="l00161"></a>00161       call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Could not read start of growing season"</span> )
<a name="l00162"></a>00162       call Chomp ( sRecord, sArgument )
<a name="l00163"></a>00163       <span class="keyword">read</span> ( sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00164"></a>00164       pConfig%iDayOfLastFrost = INT(rValue,kind=T_INT)
<a name="l00165"></a>00165       call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Could not read end of growing season"</span> )
<a name="l00166"></a>00166       call Chomp ( sRecord, sOption )
<a name="l00167"></a>00167       call Uppercase ( sOption )
<a name="l00168"></a>00168       <span class="keyword">if</span> (trim(sOption) == <span class="stringliteral">"TRUE"</span> ) <span class="keyword">then</span>
<a name="l00169"></a>00169         pConfig%lNorthernHemisphere = lTRUE
<a name="l00170"></a>00170       <span class="keyword">else</span>
<a name="l00171"></a>00171         pConfig%lNorthernHemisphere = lFALSE
<a name="l00172"></a>00172       <span class="keyword">end if</span>
<a name="l00173"></a>00173       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Northern Hemisphere = "</span>,pConfig%lNorthernHemisphere
<a name="l00174"></a>00174       flush(UNIT=LU_LOG)
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"PRECIPITATION"</span> ) <span class="keyword">then</span>
<a name="l00177"></a>00177       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Configuring precipitation data input"</span>
<a name="l00178"></a>00178       call Chomp ( sRecord, sOption )
<a name="l00179"></a>00179       call Uppercase ( sOption )
<a name="l00180"></a>00180       call Chomp ( sRecord, sArgument )
<a name="l00181"></a>00181       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"SINGLE_STATION"</span> ) <span class="keyword">then</span>
<a name="l00182"></a>00182         pConfig%iConfigurePrecip = CONFIG_PRECIP_SINGLE_STATION
<a name="l00183"></a>00183         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"  Precip data will be read for a single station"</span>
<a name="l00184"></a>00184       <span class="keyword">else</span>
<a name="l00185"></a>00185         <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"ARC_GRID"</span> ) <span class="keyword">then</span>
<a name="l00186"></a>00186           pConfig%iConfigurePrecip = CONFIG_PRECIP_ARC_GRID
<a name="l00187"></a>00187           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Precip data will be read as a series of ARC grids"</span>
<a name="l00188"></a>00188           pConfig%sPrecipFilePrefix = sArgument
<a name="l00189"></a>00189           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  grid file prefix for PRECIP data: "</span>, &amp;
<a name="l00190"></a>00190           TRIM(pConfig%sPrecipFilePrefix)
<a name="l00191"></a>00191         <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"SURFER"</span> ) <span class="keyword">then</span>
<a name="l00192"></a>00192           pConfig%iConfigurePrecip = CONFIG_PRECIP_SURFER_GRID
<a name="l00193"></a>00193           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Precip data will be read as a series of SURFER grids"</span>
<a name="l00194"></a>00194           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  grid file prefix for PRECIP data: "</span>, &amp;
<a name="l00195"></a>00195           TRIM(pConfig%sPrecipFilePrefix)
<a name="l00196"></a>00196 <span class="preprocessor">#ifdef NETCDF_SUPPORT</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span>        <span class="keyword">else</span> <span class="keyword">if</span>( trim(sOption) == <span class="stringliteral">"NETCDF"</span> ) <span class="keyword">then</span>
<a name="l00198"></a>00198           pConfig%iConfigurePrecip = CONFIG_PRECIP_NETCDF
<a name="l00199"></a>00199           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) &amp;
<a name="l00200"></a>00200             <span class="stringliteral">"Precip data will be read from a NetCDF file"</span>
<a name="l00201"></a>00201           pConfig%NETCDF_FILE(iNETCDF_PRECIP)%iNCID = &amp;
<a name="l00202"></a>00202               netcdf_open(TRIM(sArgument))
<a name="l00203"></a>00203           pConfig%NETCDF_FILE(iNETCDF_PRECIP)%sFilename = &amp;
<a name="l00204"></a>00204               TRIM(sArgument)
<a name="l00205"></a>00205           call Chomp ( sRecord, sArgument )
<a name="l00206"></a>00206           call netcdf_info(pConfig%NETCDF_FILE(iNETCDF_PRECIP)%iNCID, &amp;
<a name="l00207"></a>00207               iNETCDF_PRECIP, pConfig, TRIM(sArgument))
<a name="l00208"></a>00208           pConfig%NETCDF_FILE(iNETCDF_PRECIP)%sVarName = TRIM(sArgument)
<a name="l00209"></a>00209           call netcdf_chk_extent(pConfig%NETCDF_FILE(iNETCDF_PRECIP)%iNCID, &amp;
<a name="l00210"></a>00210               iNETCDF_PRECIP, pConfig, pGrd)
<a name="l00211"></a>00211 <span class="preprocessor">#endif</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span>        <span class="keyword">else</span>
<a name="l00213"></a>00213           call Assert( .false._T_LOGICAL, <span class="stringliteral">"Illegal precipitation input format specified"</span> )
<a name="l00214"></a>00214         <span class="keyword">end if</span>
<a name="l00215"></a>00215         pConfig%lGriddedData = lTRUE
<a name="l00216"></a>00216       <span class="keyword">end if</span>
<a name="l00217"></a>00217       flush(UNIT=LU_LOG)
<a name="l00218"></a>00218 
<a name="l00219"></a>00219     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"TEMPERATURE"</span> ) <span class="keyword">then</span>
<a name="l00220"></a>00220       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Configuring temperature data input"</span>
<a name="l00221"></a>00221       call Chomp ( sRecord, sOption )
<a name="l00222"></a>00222       call Uppercase ( sOption )
<a name="l00223"></a>00223       call Chomp ( sRecord, sArgument )
<a name="l00224"></a>00224       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"SINGLE_STATION"</span> ) <span class="keyword">then</span>
<a name="l00225"></a>00225         pConfig%iConfigureTemperature = CONFIG_TEMPERATURE_SINGLE_STATION
<a name="l00226"></a>00226         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"  Temperature data will be read for a single station"</span>
<a name="l00227"></a>00227       <span class="keyword">else</span>
<a name="l00228"></a>00228         <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"ARC_GRID"</span> ) <span class="keyword">then</span>
<a name="l00229"></a>00229           pConfig%iConfigureTemperature = CONFIG_TEMPERATURE_ARC_GRID
<a name="l00230"></a>00230           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Temperature data will be read as a series of ARC grids"</span>
<a name="l00231"></a>00231           pConfig%sTMAXFilePrefix = sArgument
<a name="l00232"></a>00232           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  grid file prefix for Max Temperature data: "</span>, &amp;
<a name="l00233"></a>00233              TRIM(pConfig%sTMAXFilePrefix)
<a name="l00234"></a>00234           call Chomp ( sRecord, sArgument )
<a name="l00235"></a>00235           pConfig%sTMINFilePrefix = sArgument
<a name="l00236"></a>00236           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  grid file prefix for Min Temperature data: "</span>, &amp;
<a name="l00237"></a>00237              TRIM(pConfig%sTMINFilePrefix)
<a name="l00238"></a>00238           pConfig%lGriddedData = lTRUE
<a name="l00239"></a>00239         <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"SURFER"</span> ) <span class="keyword">then</span>
<a name="l00240"></a>00240           pConfig%iConfigureTemperature = CONFIG_TEMPERATURE_SURFER_GRID
<a name="l00241"></a>00241           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Temperature data will be read as a series of SURFER grids"</span>
<a name="l00242"></a>00242           pConfig%sTMAXFilePrefix = sArgument
<a name="l00243"></a>00243           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  grid file prefix for Max Temperature data: "</span>, &amp;
<a name="l00244"></a>00244              TRIM(pConfig%sTMAXFilePrefix)
<a name="l00245"></a>00245           call Chomp ( sRecord, sArgument )
<a name="l00246"></a>00246           pConfig%sTMINFilePrefix = sArgument
<a name="l00247"></a>00247           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  grid file prefix for Min Temperature data: "</span>, &amp;
<a name="l00248"></a>00248              TRIM(pConfig%sTMINFilePrefix)
<a name="l00249"></a>00249           pConfig%lGriddedData = lTRUE
<a name="l00250"></a>00250 <span class="preprocessor">#ifdef NETCDF_SUPPORT</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>        <span class="keyword">else</span> <span class="keyword">if</span>( trim(sOption) == <span class="stringliteral">"NETCDF"</span> ) <span class="keyword">then</span>
<a name="l00252"></a>00252           pConfig%iConfigureTemperature = CONFIG_TEMPERATURE_NETCDF
<a name="l00253"></a>00253           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) &amp;
<a name="l00254"></a>00254             <span class="stringliteral">"Temperature data will be read from a NetCDF file"</span>
<a name="l00255"></a>00255           pConfig%NETCDF_FILE(iNETCDF_TMAX)%iNCID = &amp;
<a name="l00256"></a>00256               netcdf_open(TRIM(sArgument))
<a name="l00257"></a>00257           pConfig%NETCDF_FILE(iNETCDF_TMAX)%sFilename = &amp;
<a name="l00258"></a>00258               TRIM(sArgument)
<a name="l00259"></a>00259           call Chomp ( sRecord, sArgument )
<a name="l00260"></a>00260           call netcdf_info(pConfig%NETCDF_FILE(iNETCDF_TMAX)%iNCID, &amp;
<a name="l00261"></a>00261               iNETCDF_TMAX, pConfig, TRIM(sArgument))
<a name="l00262"></a>00262           pConfig%NETCDF_FILE(iNETCDF_TMAX)%sVarName = TRIM(sArgument)
<a name="l00263"></a>00263           call netcdf_chk_extent(pConfig%NETCDF_FILE(iNETCDF_TMAX)%iNCID, &amp;
<a name="l00264"></a>00264               iNETCDF_TMAX, pConfig, pGrd)
<a name="l00265"></a>00265           <span class="comment">! now repeat for TMIN file</span>
<a name="l00266"></a>00266           call Chomp ( sRecord, sArgument )
<a name="l00267"></a>00267           pConfig%NETCDF_FILE(iNETCDF_TMIN)%iNCID = &amp;
<a name="l00268"></a>00268               netcdf_open(TRIM(sArgument))
<a name="l00269"></a>00269           pConfig%NETCDF_FILE(iNETCDF_TMIN)%sFilename = &amp;
<a name="l00270"></a>00270               TRIM(sArgument)
<a name="l00271"></a>00271           call Chomp ( sRecord, sArgument )
<a name="l00272"></a>00272           call netcdf_info(pConfig%NETCDF_FILE(iNETCDF_TMIN)%iNCID, &amp;
<a name="l00273"></a>00273               iNETCDF_TMIN, pConfig, TRIM(sArgument))
<a name="l00274"></a>00274           pConfig%NETCDF_FILE(iNETCDF_TMIN)%sVarName = TRIM(sArgument)
<a name="l00275"></a>00275           call netcdf_chk_extent(pConfig%NETCDF_FILE(iNETCDF_TMIN)%iNCID, &amp;
<a name="l00276"></a>00276               iNETCDF_TMIN, pConfig, pGrd)
<a name="l00277"></a>00277 <span class="preprocessor">#endif</span>
<a name="l00278"></a>00278 <span class="preprocessor"></span>        <span class="keyword">else</span>
<a name="l00279"></a>00279           call Assert( lFALSE, <span class="stringliteral">"Illegal temperature input format specified"</span>, &amp;
<a name="l00280"></a>00280             TRIM(__FILE__),__LINE__)
<a name="l00281"></a>00281         <span class="keyword">endif</span>
<a name="l00282"></a>00282       <span class="keyword">end if</span>
<a name="l00283"></a>00283       flush(UNIT=LU_LOG)
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"FLOW_DIRECTION"</span> ) <span class="keyword">then</span>
<a name="l00286"></a>00286       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Populating flow direction grid"</span>
<a name="l00287"></a>00287       call Chomp ( sRecord, sOption )
<a name="l00288"></a>00288       call Uppercase ( sOption )
<a name="l00289"></a>00289       call Chomp ( sRecord, sArgument )
<a name="l00290"></a>00290       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00291"></a>00291         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) iValue
<a name="l00292"></a>00292         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read integer data value"</span> )
<a name="l00293"></a>00293         pGrd%Cells%iFlowDir = iValue
<a name="l00294"></a>00294       <span class="keyword">else</span>
<a name="l00295"></a>00295         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_INT_GRID )
<a name="l00296"></a>00296         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l00297"></a>00297                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00298"></a>00298         pGrd%Cells%iFlowDir = input_grd%iData
<a name="l00299"></a>00299         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00300"></a>00300       <span class="keyword">end if</span>
<a name="l00301"></a>00301       flush(UNIT=LU_LOG)
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"ROUTING_FRACTION"</span> ) <span class="keyword">then</span>
<a name="l00304"></a>00304       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Populating routing fraction grid"</span>
<a name="l00305"></a>00305       call Chomp ( sRecord, sOption )
<a name="l00306"></a>00306       call Uppercase ( sOption )
<a name="l00307"></a>00307       call Chomp ( sRecord, sArgument )
<a name="l00308"></a>00308       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00309"></a>00309         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00310"></a>00310         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00311"></a>00311           <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00312"></a>00312         pGrd%Cells%rRouteFraction = rValue
<a name="l00313"></a>00313       <span class="keyword">else</span>
<a name="l00314"></a>00314         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_SGL_GRID )
<a name="l00315"></a>00315         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l00316"></a>00316                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00317"></a>00317         pGrd%Cells%rRouteFraction = input_grd%rData
<a name="l00318"></a>00318         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00319"></a>00319         call Assert(<span class="keywordtype">LOGICAL</span>(MAXVAL(pGrd%Cells%rRouteFraction)&lt;=rONE,
<a name="l00320"></a>00320             kind=T_LOGICAL), 
<a name="l00321"></a>00321             <span class="stringliteral">"One or mode values in routing fraction grid exceed 1.0"</span>)
<a name="l00322"></a>00322         call Assert(<span class="keywordtype">LOGICAL</span>(MINVAL(pGrd%Cells%rRouteFraction)&gt;=rZERO,
<a name="l00323"></a>00323             kind=T_LOGICAL), 
<a name="l00324"></a>00324             <span class="stringliteral">"One or mode values in routing fraction grid are less than 0.0"</span>)
<a name="l00325"></a>00325       <span class="keyword">end if</span>
<a name="l00326"></a>00326       <span class="keyword">write</span>(UNIT=LU_LOG, &amp;
<a name="l00327"></a>00327         FMT=<span class="stringliteral">"('  Number of cells with normal routing: ',i8)"</span>) &amp;
<a name="l00328"></a>00328         COUNT(pGrd%Cells%rRouteFraction &gt; &amp;
<a name="l00329"></a>00329         (rONE - rNEAR_ZERO))
<a name="l00330"></a>00330       <span class="keyword">write</span>(UNIT=LU_LOG, &amp;
<a name="l00331"></a>00331         FMT=<span class="stringliteral">"('  Number of cells with fractional routing: ',i8)"</span>) &amp;
<a name="l00332"></a>00332         COUNT(pGrd%Cells%rRouteFraction &lt;= &amp;
<a name="l00333"></a>00333         (rONE - rNEAR_ZERO))
<a name="l00334"></a>00334       flush(UNIT=LU_LOG)
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"INITIAL_FROZEN_GROUND_INDEX"</span> ) <span class="keyword">then</span>
<a name="l00337"></a>00337       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Initializing continuous frozen ground index"</span>
<a name="l00338"></a>00338       call Chomp ( sRecord, sOption )
<a name="l00339"></a>00339       call Uppercase ( sOption )
<a name="l00340"></a>00340       call Chomp ( sRecord, sArgument )
<a name="l00341"></a>00341       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00342"></a>00342         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00343"></a>00343         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00344"></a>00344         pGrd%Cells%rCFGI = rValue
<a name="l00345"></a>00345       <span class="keyword">else</span>
<a name="l00346"></a>00346         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_SGL_GRID )
<a name="l00347"></a>00347         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l00348"></a>00348                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00349"></a>00349         pGrd%Cells%rCFGI = input_grd%rData
<a name="l00350"></a>00350         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00351"></a>00351       <span class="keyword">end if</span>
<a name="l00352"></a>00352       flush(UNIT=LU_LOG)
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"PATH_DELIMITER"</span> ) <span class="keyword">then</span>
<a name="l00355"></a>00355       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) &amp;
<a name="l00356"></a>00356         <span class="stringliteral">"Setting delimiter character for referencing pathnames"</span>
<a name="l00357"></a>00357       call Chomp ( sRecord, sArgument )
<a name="l00358"></a>00358       pConfig%sSlash = TRIM(ADJUSTL(sArgument))
<a name="l00359"></a>00359       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  &amp;
<a name="l00360"></a>00360         <span class="stringliteral">"Delimiter character for referencing pathnames set to: '"</span> &amp;
<a name="l00361"></a>00361         //TRIM(pConfig%sSlash)//<span class="stringliteral">"'"</span>
<a name="l00362"></a>00362       flush(UNIT=LU_LOG)
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"STATS_START_YEAR"</span> ) <span class="keyword">then</span>
<a name="l00365"></a>00365       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) &amp;
<a name="l00366"></a>00366         <span class="stringliteral">"Setting starting year for calculation of recharge statistics"</span>
<a name="l00367"></a>00367       call Chomp ( sRecord, sArgument )
<a name="l00368"></a>00368       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) iValue
<a name="l00369"></a>00369       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read integer data value"</span> )
<a name="l00370"></a>00370       pConfig%iFirstYearforCalculation = iValue
<a name="l00371"></a>00371       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  &amp;
<a name="l00372"></a>00372         <span class="stringliteral">"First year for recharge stats calculations:"</span>, iValue
<a name="l00373"></a>00373       flush(UNIT=LU_LOG)
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"STATS_END_YEAR"</span> ) <span class="keyword">then</span>
<a name="l00376"></a>00376       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) &amp;
<a name="l00377"></a>00377         <span class="stringliteral">"Setting ending year for calculation of recharge statistics"</span>
<a name="l00378"></a>00378       call Chomp ( sRecord, sArgument )
<a name="l00379"></a>00379       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) iValue
<a name="l00380"></a>00380       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read integer data value"</span> )
<a name="l00381"></a>00381       pConfig%iLastYearforCalculation = iValue
<a name="l00382"></a>00382       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  &amp;
<a name="l00383"></a>00383         <span class="stringliteral">"Last year for recharge stats calculations:"</span>, iValue
<a name="l00384"></a>00384       flush(UNIT=LU_LOG)
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"LOWER_LIMIT_CFGI"</span> ) <span class="keyword">then</span>
<a name="l00387"></a>00387       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) &amp;
<a name="l00388"></a>00388         <span class="stringliteral">"Initializing lower boundary for continuous frozen ground index threshold"</span>
<a name="l00389"></a>00389       call Chomp ( sRecord, sArgument )
<a name="l00390"></a>00390       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00391"></a>00391       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00392"></a>00392       pConfig%rLL_CFGI = rValue
<a name="l00393"></a>00393       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  &amp;
<a name="l00394"></a>00394         <span class="stringliteral">"Ground will be considered unfrozen at a CFGI value of: "</span>, rValue
<a name="l00395"></a>00395       flush(UNIT=LU_LOG)
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"UPPER_LIMIT_CFGI"</span> ) <span class="keyword">then</span>
<a name="l00398"></a>00398       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) &amp;
<a name="l00399"></a>00399         <span class="stringliteral">"Initializing upper boundary for continuous frozen ground index threshold"</span>
<a name="l00400"></a>00400       call Chomp ( sRecord, sArgument )
<a name="l00401"></a>00401       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00402"></a>00402       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00403"></a>00403       pConfig%rUL_CFGI = rValue
<a name="l00404"></a>00404       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Ground will be considered frozen at a CFGI value of: "</span>, rValue
<a name="l00405"></a>00405       flush(UNIT=LU_LOG)
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"GRID_LENGTH_UNITS"</span> ) <span class="keyword">then</span>
<a name="l00408"></a>00408       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Setting grid length units"</span>
<a name="l00409"></a>00409       call Chomp ( sRecord, sArgument )
<a name="l00410"></a>00410       <span class="keyword">if</span>(TRIM(sArgument)==<span class="stringliteral">"FEET"</span>) <span class="keyword">then</span>
<a name="l00411"></a>00411         pGrd%iLengthUnits = iGRID_LENGTH_UNITS_FEET
<a name="l00412"></a>00412       elseif(TRIM(sArgument)==<span class="stringliteral">"METERS"</span>) <span class="keyword">then</span>
<a name="l00413"></a>00413         pGrd%iLengthUnits = iGRID_LENGTH_UNITS_METERS
<a name="l00414"></a>00414       <span class="keyword">else</span>
<a name="l00415"></a>00415         call Assert(lFALSE , <span class="stringliteral">"Grid units may only be set to METERS or FEET"</span> )
<a name="l00416"></a>00416       <span class="keyword">endif</span>
<a name="l00417"></a>00417       flush(UNIT=LU_LOG)
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"REFERENCE_ET_SLOPE"</span> ) <span class="keyword">then</span>
<a name="l00420"></a>00420       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Initializing slope factor for reference ET method"</span>
<a name="l00421"></a>00421       call Chomp ( sRecord, sArgument )
<a name="l00422"></a>00422       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00423"></a>00423       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00424"></a>00424       pConfig%rET_Slope = rValue
<a name="l00425"></a>00425       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Reference ET slope set to: "</span>, rValue
<a name="l00426"></a>00426       flush(UNIT=LU_LOG)
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"REFERENCE_ET_EXPONENT"</span> ) <span class="keyword">then</span>
<a name="l00429"></a>00429       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Initializing exponent for reference ET method"</span>
<a name="l00430"></a>00430       call Chomp ( sRecord, sArgument )
<a name="l00431"></a>00431       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00432"></a>00432       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00433"></a>00433       pConfig%rET_Exponent = rValue
<a name="l00434"></a>00434       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Reference ET exponent set to: "</span>, rValue
<a name="l00435"></a>00435       flush(UNIT=LU_LOG)
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"REFERENCE_ET_CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00438"></a>00438       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Initializing constant for reference ET method"</span>
<a name="l00439"></a>00439       call Chomp ( sRecord, sArgument )
<a name="l00440"></a>00440       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00441"></a>00441       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00442"></a>00442       pConfig%rET_Constant = rValue
<a name="l00443"></a>00443       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Reference ET constant set to: "</span>, rValue
<a name="l00444"></a>00444       flush(UNIT=LU_LOG)
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 
<a name="l00447"></a>00447     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"RAINFALL_CORRECTION_FACTOR"</span> ) <span class="keyword">then</span>
<a name="l00448"></a>00448       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Initializing rainfall correction factor"</span>
<a name="l00449"></a>00449       call Chomp ( sRecord, sArgument )
<a name="l00450"></a>00450       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00451"></a>00451       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00452"></a>00452       pConfig%rRainfall_Corr_Factor = rValue
<a name="l00453"></a>00453       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Rainfall correction factor set to: "</span>, rValue
<a name="l00454"></a>00454       flush(UNIT=LU_LOG)
<a name="l00455"></a>00455 
<a name="l00456"></a>00456     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"SNOWFALL_CORRECTION_FACTOR"</span> ) <span class="keyword">then</span>
<a name="l00457"></a>00457       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Initializing snowfall correction factor"</span>
<a name="l00458"></a>00458       call Chomp ( sRecord, sArgument )
<a name="l00459"></a>00459       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00460"></a>00460       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00461"></a>00461       pConfig%rSnowfall_Corr_Factor = rValue
<a name="l00462"></a>00462       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Snowfall correction factor set to: "</span>, rValue
<a name="l00463"></a>00463       flush(UNIT=LU_LOG)
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"OPEN_WATER_LAND_USE"</span> ) <span class="keyword">then</span>
<a name="l00466"></a>00466       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Setting open water land use type"</span>
<a name="l00467"></a>00467       call Chomp ( sRecord, sArgument )
<a name="l00468"></a>00468       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) iValue
<a name="l00469"></a>00469       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read integer data value"</span> )
<a name="l00470"></a>00470       pConfig%iOPEN_WATER_LU = iValue
<a name="l00471"></a>00471       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Cell will be considered to be open water given"</span> &amp;
<a name="l00472"></a>00472         // <span class="stringliteral">" a land use code of "</span>, iValue
<a name="l00473"></a>00473       flush(UNIT=LU_LOG)
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"ELEVATION"</span> ) <span class="keyword">then</span>
<a name="l00476"></a>00476       <span class="keyword">write</span>(unit=LU_LOG, fmt=*) <span class="stringliteral">"Reading elevation grid"</span>
<a name="l00477"></a>00477       call Chomp ( sRecord, sOption )
<a name="l00478"></a>00478       call Uppercase ( sOption )
<a name="l00479"></a>00479       call Chomp ( sRecord, sArgument )
<a name="l00480"></a>00480       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00481"></a>00481         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00482"></a>00482         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00483"></a>00483           <span class="stringliteral">"Cannot read floating point data value"</span> )
<a name="l00484"></a>00484         pGrd%Cells%rElevation = rValue
<a name="l00485"></a>00485       <span class="keyword">else</span>
<a name="l00486"></a>00486         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_SGL_GRID )
<a name="l00487"></a>00487         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l00488"></a>00488                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00489"></a>00489         pGrd%Cells%rElevation = input_grd%rData
<a name="l00490"></a>00490         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00491"></a>00491       <span class="keyword">end if</span>
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"SOIL_GROUP"</span> ) <span class="keyword">then</span>
<a name="l00494"></a>00494       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Populating soil group grid"</span>
<a name="l00495"></a>00495       call Chomp ( sRecord, sOption )
<a name="l00496"></a>00496       call Uppercase ( sOption )
<a name="l00497"></a>00497       call Chomp ( sRecord, sArgument )
<a name="l00498"></a>00498       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00499"></a>00499         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) iValue
<a name="l00500"></a>00500         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00501"></a>00501           <span class="stringliteral">"Cannot read integer data value"</span> )
<a name="l00502"></a>00502         pGrd%Cells%iSoilGroup = iValue
<a name="l00503"></a>00503       <span class="keyword">else</span>
<a name="l00504"></a>00504         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_INT_GRID )
<a name="l00505"></a>00505         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l00506"></a>00506                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00507"></a>00507         pGrd%Cells%iSoilGroup = input_grd%iData
<a name="l00508"></a>00508         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00509"></a>00509       <span class="keyword">end if</span>
<a name="l00510"></a>00510       flush(UNIT=LU_LOG)
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"LAND_USE"</span> ) <span class="keyword">then</span>
<a name="l00513"></a>00513       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Populating land use grid"</span>
<a name="l00514"></a>00514       call Chomp ( sRecord, sOption )
<a name="l00515"></a>00515       call Uppercase ( sOption )
<a name="l00516"></a>00516       call Chomp ( sRecord, sArgument )
<a name="l00517"></a>00517       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00518"></a>00518         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) iValue
<a name="l00519"></a>00519         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read integer data value"</span> )
<a name="l00520"></a>00520         pGrd%Cells%iLandUse = iValue
<a name="l00521"></a>00521       <span class="keyword">else</span>
<a name="l00522"></a>00522         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_INT_GRID )
<a name="l00523"></a>00523         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ),  &amp;
<a name="l00524"></a>00524                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00525"></a>00525         pGrd%Cells%iLandUse = input_grd%iData
<a name="l00526"></a>00526         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00527"></a>00527       <span class="keyword">end if</span>
<a name="l00528"></a>00528       flush(UNIT=LU_LOG)
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"LAND_USE_LOOKUP_TABLE"</span> ) <span class="keyword">then</span>
<a name="l00531"></a>00531       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Reading land-use lookup table"</span>
<a name="l00532"></a>00532       call Chomp ( sRecord, pConfig%sLandUseLookupFilename )
<a name="l00533"></a>00533       <span class="keyword">if</span> ( len_trim(pConfig%sLandUseLookupFilename) == 0 ) <span class="keyword">then</span>
<a name="l00534"></a>00534         call Assert( .false._T_LOGICAL, <span class="stringliteral">"No land use lookup table specified"</span> )
<a name="l00535"></a>00535       <span class="keyword">end if</span>
<a name="l00536"></a>00536       call <a class="code" href="namespacegavg.html#e07f7a0a57e0cd40b00b4b41ad4d5a23">gavg_ReadLanduseLookupTable</a>( pConfig )
<a name="l00537"></a>00537       flush(UNIT=LU_LOG)
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"BASIN_MASK_LOOKUP_TABLE"</span> ) <span class="keyword">then</span>
<a name="l00540"></a>00540       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Reading basin mask lookup table"</span>
<a name="l00541"></a>00541       call Chomp ( sRecord, pConfig%sBasinMaskFilename )
<a name="l00542"></a>00542       <span class="keyword">if</span> ( len_trim(pConfig%sBasinMaskFilename) == 0 ) <span class="keyword">then</span>
<a name="l00543"></a>00543         call Assert( .false._T_LOGICAL, <span class="stringliteral">"No basin mask table specified"</span> )
<a name="l00544"></a>00544       <span class="keyword">end if</span>
<a name="l00545"></a>00545       call <a class="code" href="namespacegavg.html#be467ecdcb166a376caf0e0b03529ffc">gavg_ReadBasinMaskTable</a>( pConfig )
<a name="l00546"></a>00546       flush(UNIT=LU_LOG)
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"ADJUSTED_WATER_CAPACITY"</span> ) <span class="keyword">then</span>
<a name="l00549"></a>00549       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Populating adjusted water capacity grid"</span>
<a name="l00550"></a>00550       call Chomp ( sRecord, sOption )
<a name="l00551"></a>00551       call Uppercase ( sOption )
<a name="l00552"></a>00552       call Chomp ( sRecord, sArgument )
<a name="l00553"></a>00553       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00554"></a>00554         pConfig%iConfigureSMCapacity = CONFIG_SM_CAPACITY_FM_TABLE
<a name="l00555"></a>00555         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00556"></a>00556         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00557"></a>00557         pGrd%Cells%rSoilWaterCap = rValue
<a name="l00558"></a>00558         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"using a constant value for the maximum soil water capacity"</span>
<a name="l00559"></a>00559         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"NOTE: any option specified with the 'WATER_CAPACITY' option will be ignored"</span>
<a name="l00560"></a>00560       <span class="keyword">else</span>
<a name="l00561"></a>00561         pConfig%iConfigureSMCapacity = CONFIG_SM_CAPACITY_FM_TABLE
<a name="l00562"></a>00562         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_SGL_GRID )
<a name="l00563"></a>00563         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l00564"></a>00564                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00565"></a>00565         pGrd%Cells%rSoilWaterCap = input_grd%rData
<a name="l00566"></a>00566         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00567"></a>00567         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"reading an ASCII grid to obtain the maximum soil water capacity"</span>
<a name="l00568"></a>00568         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"NOTE: any option specified with the 'WATER_CAPACITY' option will be ignored"</span>
<a name="l00569"></a>00569       <span class="keyword">end if</span>
<a name="l00570"></a>00570       flush(UNIT=LU_LOG)
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"WATER_CAPACITY"</span> ) <span class="keyword">then</span>
<a name="l00573"></a>00573       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Populating water capacity grid"</span>
<a name="l00574"></a>00574       call Chomp ( sRecord, sOption )
<a name="l00575"></a>00575       call Uppercase ( sOption )
<a name="l00576"></a>00576       call Chomp ( sRecord, sArgument )
<a name="l00577"></a>00577       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00578"></a>00578         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00579"></a>00579         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00580"></a>00580         pGrd%Cells%rSoilWaterCapInput = rValue
<a name="l00581"></a>00581       <span class="keyword">else</span>
<a name="l00582"></a>00582         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_SGL_GRID )
<a name="l00583"></a>00583         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l00584"></a>00584                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00585"></a>00585         pGrd%Cells%rSoilWaterCapInput = input_grd%rData
<a name="l00586"></a>00586         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00587"></a>00587       <span class="keyword">end if</span>
<a name="l00588"></a>00588       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Water capacity grid MINUMUM VALUE:"</span>, &amp;
<a name="l00589"></a>00589          minval(pGrd%Cells%rSoilWaterCapInput)
<a name="l00590"></a>00590       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Water capacity grid MAXIMUM VALUE:"</span>, &amp;
<a name="l00591"></a>00591          maxval(pGrd%Cells%rSoilWaterCapInput)
<a name="l00592"></a>00592       flush(UNIT=LU_LOG)
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"INITIAL_SOIL_MOISTURE"</span> ) <span class="keyword">then</span>
<a name="l00595"></a>00595       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Populating initial moisture grid"</span>
<a name="l00596"></a>00596       call Chomp ( sRecord, sOption )
<a name="l00597"></a>00597       call Uppercase ( sOption )
<a name="l00598"></a>00598       call Chomp ( sRecord, sArgument )
<a name="l00599"></a>00599       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00600"></a>00600         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00601"></a>00601         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00602"></a>00602         pGrd%Cells%rSoilMoisturePct = rValue
<a name="l00603"></a>00603       <span class="keyword">else</span>
<a name="l00604"></a>00604         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_SGL_GRID )
<a name="l00605"></a>00605         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l00606"></a>00606                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00607"></a>00607         pGrd%Cells%rSoilMoisturePct = input_grd%rData
<a name="l00608"></a>00608         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00609"></a>00609       <span class="keyword">end if</span>
<a name="l00610"></a>00610       flush(UNIT=LU_LOG)
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"ELEVATION_ADJUSTMENT"</span> ) <span class="keyword">then</span>
<a name="l00613"></a>00613       <span class="comment">!! This expects to read four real values:</span>
<a name="l00614"></a>00614       <span class="comment">!!</span>
<a name="l00615"></a>00615       <span class="comment">!! rStationElevation -- The elevation of the weather station</span>
<a name="l00616"></a>00616       <span class="comment">!! rDryFactor -- The factor (per foot of difference between the station and ground</span>
<a name="l00617"></a>00617       <span class="comment">!!               surface for temperature adjustment when conditions are "dry"</span>
<a name="l00618"></a>00618       <span class="comment">!! rHumidFactor -- The factor (per foot of difference between the station and ground</span>
<a name="l00619"></a>00619       <span class="comment">!!               surface for temperature adjustment when conditions are "humid"</span>
<a name="l00620"></a>00620       <span class="comment">!! rHumidityThreshold -- the minimum relative humidity for "humid" conditions.</span>
<a name="l00621"></a>00621       <span class="comment">!!                If this value is 9999, the "dry" factor is always used (this is</span>
<a name="l00622"></a>00622       <span class="comment">!!                useful for simulations where humidity data are not available)</span>
<a name="l00623"></a>00623       call Chomp( sRecord, sArgument )
<a name="l00624"></a>00624       <span class="keyword">read</span>(unit=sArgument, fmt=*, iostat=iStat) pconfig%rElevStationElevation
<a name="l00625"></a>00625       call Assert( <span class="keywordtype">logical(iStat==0, kind=T_LOGICAL)</span>, 
<a name="l00626"></a>00626         <span class="stringliteral">"Failed to read station elevation "</span> // sArgument )
<a name="l00627"></a>00627       call Chomp( sRecord, sArgument )
<a name="l00628"></a>00628       <span class="keyword">read</span>(unit=sArgument, fmt=*, iostat=iStat) pconfig%rElevDryFactor
<a name="l00629"></a>00629       call Assert( <span class="keywordtype">logical(iStat==0, kind=T_LOGICAL)</span>, 
<a name="l00630"></a>00630         <span class="stringliteral">"Failed to read dry elevation factor "</span> // sArgument )
<a name="l00631"></a>00631       call Chomp( sRecord, sArgument )
<a name="l00632"></a>00632       <span class="keyword">read</span>(unit=sArgument, fmt=*, iostat=iStat) pconfig%rElevHumidFactor
<a name="l00633"></a>00633       call Assert( <span class="keywordtype">logical(iStat==0, kind=T_LOGICAL)</span>, 
<a name="l00634"></a>00634         <span class="stringliteral">"Failed to read humid elevation factor "</span> // sArgument )
<a name="l00635"></a>00635       call Chomp( sRecord, sArgument )
<a name="l00636"></a>00636       <span class="keyword">read</span>(unit=sArgument, fmt=*, iostat=iStat) pconfig%rElevHumidityThreshold
<a name="l00637"></a>00637       call Assert( <span class="keywordtype">logical(iStat==0, kind=T_LOGICAL)</span>, 
<a name="l00638"></a>00638         <span class="stringliteral">"Failed to read humidity threshold "</span> // sArgument )
<a name="l00639"></a>00639       pconfig%lElevAdjustment = .true.
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"RLE_MULTIPLIER"</span> ) <span class="keyword">then</span>
<a name="l00642"></a>00642       call Chomp ( sRecord, sArgument )
<a name="l00643"></a>00643       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Setting the value for the RLE multiplier"</span>
<a name="l00644"></a>00644       <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) iValue
<a name="l00645"></a>00645       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read integer data value"</span> )
<a name="l00646"></a>00646 <span class="comment">!      iRLE_MULTIPLIER = iValue</span>
<a name="l00647"></a>00647       pConfig%iRLE_MULT = iValue
<a name="l00648"></a>00648       flush(UNIT=LU_LOG)
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"OUTPUT_OPTIONS"</span> ) <span class="keyword">then</span>
<a name="l00651"></a>00651       call Chomp ( sRecord, sArgument )
<a name="l00652"></a>00652       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Setting the output options (daily, monthly, annual)"</span>
<a name="l00653"></a>00653       <span class="keyword">do</span> i=1,iNUM_VARIABLES
<a name="l00654"></a>00654         <span class="keyword">if</span>(TRIM(sArgument) == TRIM(STAT_INFO(i)%sVARIABLE_NAME)) <span class="keyword">then</span>
<a name="l00655"></a>00655           iVarNum = i
<a name="l00656"></a>00656           exit
<a name="l00657"></a>00657         <span class="keyword">end if</span>
<a name="l00658"></a>00658       <span class="keyword">end do</span>
<a name="l00659"></a>00659 
<a name="l00660"></a>00660       <span class="comment">! set daily output options</span>
<a name="l00661"></a>00661       call Chomp ( sRecord, sArgument )
<a name="l00662"></a>00662       <span class="keyword">if</span> (TRIM(sArgument)== <span class="stringliteral">"GRID"</span>) <span class="keyword">then</span>
<a name="l00663"></a>00663         STAT_INFO(iVarNum)%iDailyOutput = iGRID
<a name="l00664"></a>00664 <span class="preprocessor">#ifdef GRAPHICS_SUPPORT</span>
<a name="l00665"></a>00665 <span class="preprocessor"></span>      <span class="keyword">else</span> <span class="keyword">if</span> (TRIM(sArgument)== <span class="stringliteral">"GRAPH"</span>) <span class="keyword">then</span>
<a name="l00666"></a>00666         STAT_INFO(iVarNum)%iDailyOutput = iGRAPH
<a name="l00667"></a>00667       <span class="keyword">else</span> <span class="keyword">if</span> (TRIM(sArgument)== <span class="stringliteral">"BOTH"</span>) <span class="keyword">then</span>
<a name="l00668"></a>00668         STAT_INFO(iVarNum)%iDailyOutput = iBOTH
<a name="l00669"></a>00669 <span class="preprocessor">#endif</span>
<a name="l00670"></a>00670 <span class="preprocessor"></span>      <span class="keyword">else</span>
<a name="l00671"></a>00671         STAT_INFO(iVarNum)%iDailyOutput = iNONE
<a name="l00672"></a>00672       <span class="keyword">end if</span>
<a name="l00673"></a>00673 
<a name="l00674"></a>00674       <span class="comment">! now repeat for monthly output options</span>
<a name="l00675"></a>00675       call Chomp ( sRecord, sArgument )
<a name="l00676"></a>00676       <span class="keyword">if</span> (TRIM(sArgument)== <span class="stringliteral">"GRID"</span>) <span class="keyword">then</span>
<a name="l00677"></a>00677         STAT_INFO(iVarNum)%iMonthlyOutput = iGRID
<a name="l00678"></a>00678 <span class="preprocessor">#ifdef GRAPHICS_SUPPORT</span>
<a name="l00679"></a>00679 <span class="preprocessor"></span>      <span class="keyword">else</span> <span class="keyword">if</span> (TRIM(sArgument)== <span class="stringliteral">"GRAPH"</span>) <span class="keyword">then</span>
<a name="l00680"></a>00680         STAT_INFO(iVarNum)%iMonthlyOutput = iGRAPH
<a name="l00681"></a>00681       <span class="keyword">else</span> <span class="keyword">if</span> (TRIM(sArgument)== <span class="stringliteral">"BOTH"</span>) <span class="keyword">then</span>
<a name="l00682"></a>00682         STAT_INFO(iVarNum)%iMonthlyOutput = iBOTH
<a name="l00683"></a>00683 <span class="preprocessor">#endif</span>
<a name="l00684"></a>00684 <span class="preprocessor"></span>      <span class="keyword">else</span>
<a name="l00685"></a>00685         STAT_INFO(iVarNum)%iMonthlyOutput = iNONE
<a name="l00686"></a>00686       <span class="keyword">end if</span>
<a name="l00687"></a>00687 
<a name="l00688"></a>00688       <span class="comment">! finally, repeat for annual output options</span>
<a name="l00689"></a>00689       call Chomp ( sRecord, sArgument )
<a name="l00690"></a>00690       <span class="keyword">if</span> (TRIM(sArgument)== <span class="stringliteral">"GRID"</span>) <span class="keyword">then</span>
<a name="l00691"></a>00691         STAT_INFO(iVarNum)%iAnnualOutput = iGRID
<a name="l00692"></a>00692 <span class="preprocessor">#ifdef GRAPHICS_SUPPORT</span>
<a name="l00693"></a>00693 <span class="preprocessor"></span>      <span class="keyword">else</span> <span class="keyword">if</span> (TRIM(sArgument)== <span class="stringliteral">"GRAPH"</span>) <span class="keyword">then</span>
<a name="l00694"></a>00694         STAT_INFO(iVarNum)%iAnnualOutput = iGRAPH
<a name="l00695"></a>00695       <span class="keyword">else</span> <span class="keyword">if</span> (TRIM(sArgument)== <span class="stringliteral">"BOTH"</span>) <span class="keyword">then</span>
<a name="l00696"></a>00696         STAT_INFO(iVarNum)%iAnnualOutput = iBOTH
<a name="l00697"></a>00697 <span class="preprocessor">#endif</span>
<a name="l00698"></a>00698 <span class="preprocessor"></span>      <span class="keyword">else</span>
<a name="l00699"></a>00699         STAT_INFO(iVarNum)%iAnnualOutput = iNONE
<a name="l00700"></a>00700       <span class="keyword">end if</span>
<a name="l00701"></a>00701 
<a name="l00702"></a>00702       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Options have been set for: "</span>, &amp;
<a name="l00703"></a>00703          TRIM(STAT_INFO(iVarNum)%sVARIABLE_NAME)
<a name="l00704"></a>00704       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"STAT_INFO(iVarNum)%iAnnualOutput: "</span>,&amp;
<a name="l00705"></a>00705          STAT_INFO(iVarNum)%iAnnualOutput
<a name="l00706"></a>00706       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"STAT_INFO(iVarNum)%iMonthlyOutput: "</span>,&amp;
<a name="l00707"></a>00707          STAT_INFO(iVarNum)%iMonthlyOutput
<a name="l00708"></a>00708       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"STAT_INFO(iVarNum)%iDailyOutput: "</span>,&amp;
<a name="l00709"></a>00709          STAT_INFO(iVarNum)%iDailyOutput
<a name="l00710"></a>00710 
<a name="l00711"></a>00711 <span class="preprocessor">#ifdef GRAPHICS_SUPPORT</span>
<a name="l00712"></a>00712 <span class="preprocessor"></span>    <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"DISLIN_PARAMETERS"</span> ) <span class="keyword">then</span>
<a name="l00713"></a>00713       call Chomp ( sRecord, sArgument )
<a name="l00714"></a>00714       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Setting the values for DISLIN parameters"</span>
<a name="l00715"></a>00715       <span class="keyword">do</span> i=1,iNUM_VARIABLES
<a name="l00716"></a>00716         <span class="keyword">if</span>(TRIM(sArgument) == TRIM(STAT_INFO(i)%sVARIABLE_NAME)) <span class="keyword">then</span>
<a name="l00717"></a>00717           iVarNum = i
<a name="l00718"></a>00718           exit
<a name="l00719"></a>00719         <span class="keyword">end if</span>
<a name="l00720"></a>00720       <span class="keyword">end do</span>
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     <span class="keyword">else</span> <span class="keyword">if</span> ( TRIM(sItem) == <span class="stringliteral">"SET_PAGE"</span> ) <span class="keyword">then</span>
<a name="l00723"></a>00723       <span class="keyword">if</span>(iVarNum&gt;0 .and. iVarNum &lt;= iNUM_VARIABLES) <span class="keyword">then</span>
<a name="l00724"></a>00724          call Chomp ( sRecord, sArgument )
<a name="l00725"></a>00725          pGraph(iVarNum)%cPAPER_SIZE = TRIM(sArgument)
<a name="l00726"></a>00726       <span class="keyword">else</span>
<a name="l00727"></a>00727          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"FAILED to set DISLIN page size; make sure that the "</span>
<a name="l00728"></a>00728          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)   <span class="stringliteral">"  DISLIN variable name has been set and is valid"</span>
<a name="l00729"></a>00729       <span class="keyword">end if</span>
<a name="l00730"></a>00730 
<a name="l00731"></a>00731     <span class="keyword">else</span> <span class="keyword">if</span> ( TRIM(sItem) == <span class="stringliteral">"SET_DEVICE"</span> ) <span class="keyword">then</span>
<a name="l00732"></a>00732       <span class="keyword">if</span>(iVarNum&gt;0 .and. iVarNum &lt;= iNUM_VARIABLES) <span class="keyword">then</span>
<a name="l00733"></a>00733          call Chomp ( sRecord, sArgument )
<a name="l00734"></a>00734          pGraph(iVarNum)%cCDEV = TRIM(sArgument)
<a name="l00735"></a>00735       <span class="keyword">else</span>
<a name="l00736"></a>00736          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"FAILED to set DISLIN output device; make sure that the "</span>
<a name="l00737"></a>00737          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)   <span class="stringliteral">"  DISLIN variable name has been set and is valid"</span>
<a name="l00738"></a>00738       <span class="keyword">end if</span>
<a name="l00739"></a>00739 
<a name="l00740"></a>00740     <span class="keyword">else</span> <span class="keyword">if</span> ( TRIM(sItem) == <span class="stringliteral">"SET_COLOR_TABLE"</span> ) <span class="keyword">then</span>
<a name="l00741"></a>00741       <span class="keyword">if</span>(iVarNum&gt;0 .and. iVarNum &lt;= iNUM_VARIABLES) <span class="keyword">then</span>
<a name="l00742"></a>00742          call Chomp ( sRecord, sArgument )
<a name="l00743"></a>00743          pGraph(iVarNum)%cCOLOR_TABLE = TRIM(sArgument)
<a name="l00744"></a>00744       <span class="keyword">else</span>
<a name="l00745"></a>00745          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"FAILED to set DISLIN color table; make sure that the "</span>
<a name="l00746"></a>00746          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)   <span class="stringliteral">"  DISLIN variable name has been set and is valid"</span>
<a name="l00747"></a>00747       <span class="keyword">end if</span>
<a name="l00748"></a>00748 
<a name="l00749"></a>00749     <span class="keyword">else</span> <span class="keyword">if</span> ( TRIM(sItem) == <span class="stringliteral">"SET_FONT"</span> ) <span class="keyword">then</span>
<a name="l00750"></a>00750       <span class="keyword">if</span>(iVarNum&gt;0 .and. iVarNum &lt;= iNUM_VARIABLES) <span class="keyword">then</span>
<a name="l00751"></a>00751          call Chomp ( sRecord, sArgument )
<a name="l00752"></a>00752          pGraph(iVarNum)%cFONT_NAME = TRIM(sArgument)
<a name="l00753"></a>00753       <span class="keyword">else</span>
<a name="l00754"></a>00754          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"FAILED to set DISLIN font name; make sure that the "</span>
<a name="l00755"></a>00755          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)   <span class="stringliteral">"  DISLIN variable name has been set and is valid"</span>
<a name="l00756"></a>00756       <span class="keyword">end if</span>
<a name="l00757"></a>00757 
<a name="l00758"></a>00758     <span class="keyword">else</span> <span class="keyword">if</span> ( TRIM(sItem) == <span class="stringliteral">"Z_AXIS_TITLE"</span> ) <span class="keyword">then</span>
<a name="l00759"></a>00759       <span class="keyword">if</span>(iVarNum&gt;0 .and. iVarNum &lt;= iNUM_VARIABLES) <span class="keyword">then</span>
<a name="l00760"></a>00760 <span class="comment">!         call Chomp ( sRecord, sArgument )</span>
<a name="l00761"></a>00761          pGraph(iVarNum)%cZ_AXIS_TITLE = TRIM(sRecord)
<a name="l00762"></a>00762       <span class="keyword">else</span>
<a name="l00763"></a>00763          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"FAILED to set DISLIN parameter; make sure that the "</span>
<a name="l00764"></a>00764          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)   <span class="stringliteral">"  DISLIN variable name has been set and is valid"</span>
<a name="l00765"></a>00765       <span class="keyword">end if</span>
<a name="l00766"></a>00766 
<a name="l00767"></a>00767     <span class="keyword">else</span> <span class="keyword">if</span> ( TRIM(sItem) == <span class="stringliteral">"SET_Z_AXIS_RANGE"</span> ) <span class="keyword">then</span>
<a name="l00768"></a>00768       <span class="keyword">if</span>(iVarNum&gt;0 .and. iVarNum &lt;= iNUM_VARIABLES) <span class="keyword">then</span>
<a name="l00769"></a>00769          call Chomp ( sRecord, sArgument )
<a name="l00770"></a>00770          <span class="keyword">if</span>(TRIM(sArgument)==<span class="stringliteral">"DAILY"</span>) <span class="keyword">then</span>
<a name="l00771"></a>00771            iTimeFrame = iDAILY
<a name="l00772"></a>00772          <span class="keyword">else</span> <span class="keyword">if</span>(TRIM(sArgument)==<span class="stringliteral">"MONTHLY"</span>) <span class="keyword">then</span>
<a name="l00773"></a>00773            iTimeFrame = iMONTHLY
<a name="l00774"></a>00774          <span class="keyword">else</span>
<a name="l00775"></a>00775            iTimeFrame = iANNUAL
<a name="l00776"></a>00776          <span class="keyword">end if</span>
<a name="l00777"></a>00777 
<a name="l00778"></a>00778          call Chomp ( sRecord, sArgument )
<a name="l00779"></a>00779          <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00780"></a>00780          call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00781"></a>00781             <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00782"></a>00782          pGraph(iVarNum)%rZA(iTimeFrame) = rValue
<a name="l00783"></a>00783 
<a name="l00784"></a>00784          call Chomp ( sRecord, sArgument )
<a name="l00785"></a>00785          <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00786"></a>00786          call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00787"></a>00787             <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00788"></a>00788          pGraph(iVarNum)%rZE(iTimeFrame) = rValue
<a name="l00789"></a>00789 
<a name="l00790"></a>00790          call Chomp ( sRecord, sArgument )
<a name="l00791"></a>00791          <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00792"></a>00792          call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00793"></a>00793             <span class="stringliteral">"Cannot read real data value"</span> )
<a name="l00794"></a>00794          pGraph(iVarNum)%rZSTEP(iTimeFrame) = rValue
<a name="l00795"></a>00795 
<a name="l00796"></a>00796          pGraph(iVarNum)%rZOR(iTimeFrame) = pGraph(iVarNum)%rZA(iTimeFrame)
<a name="l00797"></a>00797 
<a name="l00798"></a>00798       <span class="keyword">else</span>
<a name="l00799"></a>00799          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"FAILED to set DISLIN parameter; make sure that the "</span>
<a name="l00800"></a>00800          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)   <span class="stringliteral">"  DISLIN variable name has been set and is valid"</span>
<a name="l00801"></a>00801       <span class="keyword">end if</span>
<a name="l00802"></a>00802       flush(UNIT=LU_LOG)
<a name="l00803"></a>00803 
<a name="l00804"></a>00804     <span class="keyword">else</span> <span class="keyword">if</span> ( TRIM(sItem) == <span class="stringliteral">"SET_WINDOW_SIZE"</span> ) <span class="keyword">then</span>
<a name="l00805"></a>00805       <span class="keyword">if</span>(iVarNum&gt;0 .and. iVarNum &lt;= iNUM_VARIABLES) <span class="keyword">then</span>
<a name="l00806"></a>00806          call Chomp ( sRecord, sArgument )
<a name="l00807"></a>00807          <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) iValue
<a name="l00808"></a>00808          call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00809"></a>00809             <span class="stringliteral">"Cannot read integer data value"</span> )
<a name="l00810"></a>00810          pGraph(iVarNum)%iWinSizeX = iValue
<a name="l00811"></a>00811 
<a name="l00812"></a>00812          call Chomp ( sRecord, sArgument )
<a name="l00813"></a>00813          <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) iValue
<a name="l00814"></a>00814          call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l00815"></a>00815             <span class="stringliteral">"Cannot integer data value"</span> )
<a name="l00816"></a>00816          pGraph(iVarNum)%iWinSizeY = iValue
<a name="l00817"></a>00817 
<a name="l00818"></a>00818       <span class="keyword">else</span>
<a name="l00819"></a>00819          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"FAILED to set DISLIN parameter; make sure that the "</span>
<a name="l00820"></a>00820          <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)   <span class="stringliteral">"  DISLIN variable name has been set and is valid"</span>
<a name="l00821"></a>00821       <span class="keyword">end if</span>
<a name="l00822"></a>00822       flush(UNIT=LU_LOG)
<a name="l00823"></a>00823 <span class="preprocessor">#endif</span>
<a name="l00824"></a>00824 <span class="preprocessor"></span>
<a name="l00825"></a>00825     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"DRIPPS_COMPATIBILITY"</span> ) <span class="keyword">then</span>
<a name="l00826"></a>00826       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) &amp;
<a name="l00827"></a>00827         <span class="stringliteral">"DRIPPS_COMPATIBILITY is no longer a valid directive. Ignoring."</span>
<a name="l00828"></a>00828 
<a name="l00829"></a>00829     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"INITIAL_ABSTRACTION_METHOD"</span> ) <span class="keyword">then</span>
<a name="l00830"></a>00830       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Setting initial abstraction method"</span>
<a name="l00831"></a>00831       call Chomp ( sRecord, sOption )
<a name="l00832"></a>00832       call Uppercase ( sOption )
<a name="l00833"></a>00833       call Chomp ( sRecord, sArgument )
<a name="l00834"></a>00834       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"TR55"</span> ) <span class="keyword">then</span>
<a name="l00835"></a>00835         pConfig%iConfigureInitialAbstraction = CONFIG_SM_INIT_ABSTRACTION_TR55
<a name="l00836"></a>00836       <span class="keyword">else</span> <span class="keyword">if</span> (trim(sOption) == <span class="stringliteral">"HAWKINS"</span> ) <span class="keyword">then</span>
<a name="l00837"></a>00837         pConfig%iConfigureInitialAbstraction = CONFIG_SM_INIT_ABSTRACTION_HAWKINS
<a name="l00838"></a>00838       <span class="keyword">else</span>
<a name="l00839"></a>00839         call Assert( .false._T_LOGICAL, <span class="stringliteral">"Illegal initial abstraction method specified"</span> )
<a name="l00840"></a>00840       <span class="keyword">end if</span>
<a name="l00841"></a>00841       flush(UNIT=LU_LOG)
<a name="l00842"></a>00842 
<a name="l00843"></a>00843     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"ANSI_COLORS"</span> ) <span class="keyword">then</span>
<a name="l00844"></a>00844       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Setting ANSI color screen output option"</span>
<a name="l00845"></a>00845       call Chomp ( sRecord, sOption )
<a name="l00846"></a>00846       call Uppercase ( sOption )
<a name="l00847"></a>00847       call Chomp ( sRecord, sArgument )
<a name="l00848"></a>00848       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"TRUE"</span> ) <span class="keyword">then</span>
<a name="l00849"></a>00849         pConfig%lANSI_Colors = lTRUE
<a name="l00850"></a>00850       <span class="keyword">else</span>
<a name="l00851"></a>00851         pConfig%lANSI_Colors = lFALSE
<a name="l00852"></a>00852       <span class="keyword">end if</span>
<a name="l00853"></a>00853       flush(UNIT=LU_LOG)
<a name="l00854"></a>00854 
<a name="l00855"></a>00855     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"INITIAL_SNOW_COVER"</span> ) <span class="keyword">then</span>
<a name="l00856"></a>00856       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Reading initial snow cover"</span>
<a name="l00857"></a>00857       call Chomp ( sRecord, sOption )
<a name="l00858"></a>00858       call Uppercase ( sOption )
<a name="l00859"></a>00859       call Chomp ( sRecord, sArgument )
<a name="l00860"></a>00860       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l00861"></a>00861         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) rValue
<a name="l00862"></a>00862         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read real data value for initial snow cover"</span> )
<a name="l00863"></a>00863         pGrd%Cells%rSnowCover = rValue
<a name="l00864"></a>00864       <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"ARC_GRID"</span> ) <span class="keyword">then</span>
<a name="l00865"></a>00865         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Snow cover data will be read as an ARC grid"</span>
<a name="l00866"></a>00866         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_SGL_GRID )
<a name="l00867"></a>00867         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l00868"></a>00868                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00869"></a>00869         pGrd%Cells%rSnowCover = input_grd%rData
<a name="l00870"></a>00870         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00871"></a>00871       <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"SURFER"</span> ) <span class="keyword">then</span>
<a name="l00872"></a>00872         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Snow cover data will be read as a SURFER grid"</span>
<a name="l00873"></a>00873         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_SGL_GRID )
<a name="l00874"></a>00874         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l00875"></a>00875                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l00876"></a>00876         pGrd%Cells%rSnowCover = input_grd%rData
<a name="l00877"></a>00877         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l00878"></a>00878       <span class="keyword">else</span>
<a name="l00879"></a>00879         call Assert( .false._T_LOGICAL, <span class="stringliteral">"Illegal snow cover input format specified"</span> )
<a name="l00880"></a>00880       <span class="keyword">end if</span>
<a name="l00881"></a>00881       flush(UNIT=LU_LOG)
<a name="l00882"></a>00882 
<a name="l00883"></a>00883     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"RUNOFF"</span> ) <span class="keyword">then</span>
<a name="l00884"></a>00884       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Configuring runoff options"</span>
<a name="l00885"></a>00885       call Chomp ( sRecord, sOption )
<a name="l00886"></a>00886       call Uppercase ( sOption )
<a name="l00887"></a>00887       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"C-N"</span> ) <span class="keyword">then</span>
<a name="l00888"></a>00888         pConfig%iConfigureRunoff = CONFIG_RUNOFF_CURVE_NUMBER
<a name="l00889"></a>00889         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Configuring the curve number runoff model"</span>
<a name="l00890"></a>00890       <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"G-A"</span> ) <span class="keyword">then</span>
<a name="l00891"></a>00891         pConfig%iConfigureRunoff = CONFIG_RUNOFF_GREEN_AMPT
<a name="l00892"></a>00892         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Configuring the modified Green-Ampt infiltration model"</span>
<a name="l00893"></a>00893         <span class="comment">!!!STEVE</span>
<a name="l00894"></a>00894         <span class="comment">!!!PUT INITIALIZATION CODE FOR G-A IN HERE (IF NEEDED)</span>
<a name="l00895"></a>00895       <span class="keyword">else</span>
<a name="l00896"></a>00896         call Assert( .false._T_LOGICAL, <span class="stringliteral">"Illegal runoff option specified"</span> )
<a name="l00897"></a>00897       <span class="keyword">end if</span>
<a name="l00898"></a>00898       <span class="comment">! Look for a solution mode?</span>
<a name="l00899"></a>00899       <span class="keyword">if</span> (len_trim(sRecord) &gt; 0) <span class="keyword">then</span>
<a name="l00900"></a>00900         call Chomp ( sRecord, sOption )
<a name="l00901"></a>00901         call Uppercase ( sOption )
<a name="l00902"></a>00902         <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"ITERATIVE"</span> ) <span class="keyword">then</span>
<a name="l00903"></a>00903           pConfig%iConfigureRunoffMode = CONFIG_RUNOFF_ITERATIVE
<a name="l00904"></a>00904           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Configuring the iterative runoff procedure"</span>
<a name="l00905"></a>00905         <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"DOWNHILL"</span> ) <span class="keyword">then</span>
<a name="l00906"></a>00906           pConfig%iConfigureRunoffMode = CONFIG_RUNOFF_DOWNHILL
<a name="l00907"></a>00907           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Configuring the downhill runoff procedure"</span>
<a name="l00908"></a>00908         <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"NO_ROUTING"</span> ) <span class="keyword">then</span>
<a name="l00909"></a>00909           pConfig%iConfigureRunoffMode = CONFIG_RUNOFF_NO_ROUTING
<a name="l00910"></a>00910           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"NO FLOW ROUTING WILL BE PERFORMED"</span>
<a name="l00911"></a>00911         <span class="keyword">else</span>
<a name="l00912"></a>00912           call Assert( .false._T_LOGICAL, <span class="stringliteral">"Illegal runoff procedure option specified"</span> )
<a name="l00913"></a>00913         <span class="keyword">end if</span>
<a name="l00914"></a>00914       <span class="keyword">end if</span>
<a name="l00915"></a>00915       flush(UNIT=LU_LOG)
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"ITERATIVE_METHOD_TOLERANCE"</span> ) <span class="keyword">then</span>
<a name="l00918"></a>00918       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Setting iterative method solution tolerance"</span>
<a name="l00919"></a>00919       call Chomp ( sRecord, sOption )
<a name="l00920"></a>00920       <span class="keyword">read</span> ( unit=sOption, fmt=*, iostat=iStat ) rValue
<a name="l00921"></a>00921       pConfig%rIterationTolerance = rValue
<a name="l00922"></a>00922       flush(UNIT=LU_LOG)
<a name="l00923"></a>00923 
<a name="l00924"></a>00924     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"ET"</span> ) <span class="keyword">then</span>
<a name="l00925"></a>00925       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Configuring ET options"</span>
<a name="l00926"></a>00926       call Chomp ( sRecord, sOption )
<a name="l00927"></a>00927       call Uppercase ( sOption )
<a name="l00928"></a>00928       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"T-M"</span> ) <span class="keyword">then</span>
<a name="l00929"></a>00929         pConfig%iConfigureET = CONFIG_ET_THORNTHWAITE_MATHER
<a name="l00930"></a>00930 <span class="comment">!        call et_tm_configure( sRecord )</span>
<a name="l00931"></a>00931       <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"TURC"</span> ) <span class="keyword">then</span>
<a name="l00932"></a>00932         pConfig%iConfigureET = CONFIG_ET_TURC
<a name="l00933"></a>00933 <span class="comment">!        call et_turc_configure( sRecord )</span>
<a name="l00934"></a>00934       <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"J-H"</span> ) <span class="keyword">then</span>
<a name="l00935"></a>00935         pConfig%iConfigureET = CONFIG_ET_JENSEN_HAISE
<a name="l00936"></a>00936 <span class="comment">!        call et_jh_configure( sRecord )</span>
<a name="l00937"></a>00937       <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"B-C"</span> ) <span class="keyword">then</span>
<a name="l00938"></a>00938         pConfig%iConfigureET = CONFIG_ET_BLANEY_CRIDDLE
<a name="l00939"></a>00939 <span class="comment">!        call et_bc_configure( sRecord )</span>
<a name="l00940"></a>00940       <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"HARGREAVES"</span> ) <span class="keyword">then</span>
<a name="l00941"></a>00941         pConfig%iConfigureET = CONFIG_ET_HARGREAVES
<a name="l00942"></a>00942 <span class="comment">!        call et_hargreaves_configure( pConfig, sRecord )</span>
<a name="l00943"></a>00943       <span class="keyword">else</span>
<a name="l00944"></a>00944         call Assert( .false._T_LOGICAL, <span class="stringliteral">"Illegal ET option specified"</span> )
<a name="l00945"></a>00945       <span class="keyword">end if</span>
<a name="l00946"></a>00946       flush(UNIT=LU_LOG)
<a name="l00947"></a>00947 
<a name="l00948"></a>00948     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"SM"</span> ) <span class="keyword">then</span>
<a name="l00949"></a>00949       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Configuring soil-moisture options"</span>
<a name="l00950"></a>00950       call Chomp ( sRecord, sOption )
<a name="l00951"></a>00951       call Uppercase ( sOption )
<a name="l00952"></a>00952       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"T-M"</span> ) <span class="keyword">then</span>
<a name="l00953"></a>00953         pConfig%iConfigureSM = CONFIG_SM_THORNTHWAITE_MATHER
<a name="l00954"></a>00954 <span class="comment">!        call gavg_thornthwaite_mather_Configure( sRecord )</span>
<a name="l00955"></a>00955       <span class="keyword">else</span>
<a name="l00956"></a>00956         call Assert( .false._T_LOGICAL, <span class="stringliteral">"Illegal soil-moisture option specified"</span> )
<a name="l00957"></a>00957       <span class="keyword">end if</span>
<a name="l00958"></a>00958       flush(UNIT=LU_LOG)
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"OUTPUT_FORMAT"</span> ) <span class="keyword">then</span>
<a name="l00961"></a>00961       call Chomp ( sRecord, sOption )
<a name="l00962"></a>00962       call Uppercase ( sOption )
<a name="l00963"></a>00963       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"ARC_GRID"</span> ) <span class="keyword">then</span>
<a name="l00964"></a>00964         pConfig%iOutputFormat = OUTPUT_ARC
<a name="l00965"></a>00965         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Selecting ARC output format"</span>
<a name="l00966"></a>00966       <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"SURFER"</span> ) <span class="keyword">then</span>
<a name="l00967"></a>00967         pConfig%iOutputFormat = OUTPUT_SURFER
<a name="l00968"></a>00968         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Selecting SURFER output format"</span>
<a name="l00969"></a>00969       <span class="keyword">else</span>
<a name="l00970"></a>00970         call Assert( .false._T_LOGICAL, <span class="stringliteral">"Illegal output format specified"</span> )
<a name="l00971"></a>00971       <span class="keyword">end if</span>
<a name="l00972"></a>00972       flush(UNIT=LU_LOG)
<a name="l00973"></a>00973 
<a name="l00974"></a>00974     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"OUTPUT_GRID_SUFFIX"</span> ) <span class="keyword">then</span>
<a name="l00975"></a>00975       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Setting output grid file suffix"</span>
<a name="l00976"></a>00976       call Chomp ( sRecord, pConfig%sOutputFileSuffix )
<a name="l00977"></a>00977       <span class="keyword">if</span> ( len_trim(pConfig%sOutputFileSuffix) == 0 ) <span class="keyword">then</span>
<a name="l00978"></a>00978         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"[No output grid file suffix specified.  Default is 'grd']"</span>
<a name="l00979"></a>00979         pConfig%sOutputFileSuffix = <span class="stringliteral">"grd"</span>
<a name="l00980"></a>00980       <span class="keyword">endif</span>
<a name="l00981"></a>00981       flush(UNIT=LU_LOG)
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"OUTPUT_GRID_PREFIX"</span> ) <span class="keyword">then</span>
<a name="l00984"></a>00984       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Setting output grid file prefix"</span>
<a name="l00985"></a>00985       call Chomp ( sRecord, pConfig%sOutputFilePrefix )
<a name="l00986"></a>00986       <span class="keyword">if</span> ( len_trim(pConfig%sOutputFileSuffix) == 0 ) <span class="keyword">then</span>
<a name="l00987"></a>00987         <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"[No output grid file prefix specified.  Default is NULL]"</span>
<a name="l00988"></a>00988         pConfig%sOutputFilePrefix = <span class="stringliteral">""</span>
<a name="l00989"></a>00989       <span class="keyword">endif</span>
<a name="l00990"></a>00990       flush(UNIT=LU_LOG)
<a name="l00991"></a>00991 
<a name="l00992"></a>00992     <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sItem) == <span class="stringliteral">"CALC_BASIN_STATS"</span> ) <span class="keyword">then</span>
<a name="l00993"></a>00993 <span class="comment">!      call stats_CalcBasinStats(pGrd, pConfig, pGraph)</span>
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     <span class="keyword">else</span> <span class="keyword">if</span> (trim(sItem) == <span class="stringliteral">"SUPPRESS_SCREEN_OUTPUT"</span> ) <span class="keyword">then</span>
<a name="l00996"></a>00996         pConfig%lWriteToScreen = lFALSE
<a name="l00997"></a>00997 
<a name="l00998"></a>00998     <span class="keyword">else</span> <span class="keyword">if</span> (trim(sItem) == <span class="stringliteral">"SUPPRESS_DISLIN_MESSAGES"</span> ) <span class="keyword">then</span>
<a name="l00999"></a>00999         pGraph%lEnableDislinMessages = lFALSE
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     <span class="keyword">else</span> <span class="keyword">if</span> (trim(sItem) == <span class="stringliteral">"SUPPRESS_DAILY_FILES"</span> ) <span class="keyword">then</span>
<a name="l01002"></a>01002         pConfig%lReportDaily = lFALSE
<a name="l01003"></a>01003 
<a name="l01004"></a>01004 <span class="preprocessor">#ifdef STREAM_INTERACTIONS</span>
<a name="l01005"></a>01005 <span class="preprocessor"></span>    <span class="keyword">else</span> <span class="keyword">if</span> (trim(sItem) == <span class="stringliteral">"STREAM_INTERACTIONS"</span> ) <span class="keyword">then</span>
<a name="l01006"></a>01006         call Assert( <span class="keywordtype">LOGICAL(pconfig%iFractureCount &lt;= STREAM_INTERACTIONS_MAX, kind=T_LOGICAL)</span>, 
<a name="l01007"></a>01007                      <span class="stringliteral">"Space exhausted for STREAM_INTERACTIONS entries"</span>)
<a name="l01008"></a>01008         pconfig%iFractureCount = pconfig%iFractureCount+1
<a name="l01009"></a>01009         <span class="comment">! Get the special land-use code for the fracture recharge model</span>
<a name="l01010"></a>01010         call chomp(sRecord, sOption)
<a name="l01011"></a>01011         <span class="keyword">read</span> (unit=sOption, fmt=*, iostat=istat) pconfig%iFractureCode(pconfig%iFractureCount)
<a name="l01012"></a>01012         <span class="comment">! Get the daily cell maximum inflow for the fracture recharge model</span>
<a name="l01013"></a>01013         call chomp(sRecord, sOption)
<a name="l01014"></a>01014         <span class="keyword">read</span> (unit=sOption, fmt=*, iostat=istat) pconfig%rFractureMaxInflow(pconfig%iFractureCount)
<a name="l01015"></a>01015         call Assert(<span class="keywordtype">LOGICAL(pconfig%rFractureMaxInflow(pconfig%iFractureCount)</span> &gt; 0.0_T_DBL, kind=T_LOGICAL), 
<a name="l01016"></a>01016                     <span class="stringliteral">"Maximum STREAM_INTERACTIONS cell daily inflow must be positive"</span>)
<a name="l01017"></a>01017         <span class="comment">! Get the daily cell maximum recharge for the fracture recharge model</span>
<a name="l01018"></a>01018         call chomp(sRecord, sOption)
<a name="l01019"></a>01019         <span class="keyword">read</span> (unit=sOption, fmt=*, iostat=istat) pconfig%rFractureMaxRecharge(pconfig%iFractureCount)
<a name="l01020"></a>01020         call Assert(<span class="keywordtype">LOGICAL(pconfig%rFractureMaxRecharge(pconfig%iFractureCount)</span> &gt; 0.0_T_DBL, kind=T_LOGICAL), 
<a name="l01021"></a>01021                     <span class="stringliteral">"Maximum STREAM_INTERACTIONS cell daily recharge must be positive"</span>)
<a name="l01022"></a>01022 
<a name="l01023"></a>01023     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"FRACTURE_INDEX"</span> ) <span class="keyword">then</span>
<a name="l01024"></a>01024       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Populating fracture index grid"</span>
<a name="l01025"></a>01025       call Chomp ( sRecord, sOption )
<a name="l01026"></a>01026       call Uppercase ( sOption )
<a name="l01027"></a>01027       call Chomp ( sRecord, sArgument )
<a name="l01028"></a>01028       <span class="keyword">if</span> ( trim(sOption) == <span class="stringliteral">"CONSTANT"</span> ) <span class="keyword">then</span>
<a name="l01029"></a>01029         <span class="keyword">read</span> ( unit=sArgument, fmt=*, iostat=iStat ) iValue
<a name="l01030"></a>01030         call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Cannot read integer data value"</span> )
<a name="l01031"></a>01031         pGrd%Cells%iFractureID = iValue
<a name="l01032"></a>01032       <span class="keyword">else</span>
<a name="l01033"></a>01033         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sArgument, sOption, T_INT_GRID )
<a name="l01034"></a>01034         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l01035"></a>01035                       <span class="stringliteral">"Non-conforming grid"</span> )
<a name="l01036"></a>01036         pGrd%Cells%iFractureID = input_grd%iData
<a name="l01037"></a>01037         call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l01038"></a>01038       <span class="keyword">end if</span>
<a name="l01039"></a>01039       flush(UNIT=LU_LOG)
<a name="l01040"></a>01040 
<a name="l01041"></a>01041 <span class="preprocessor">#endif</span>
<a name="l01042"></a>01042 <span class="preprocessor"></span>
<a name="l01043"></a>01043     <span class="keyword">else</span> <span class="keyword">if</span> ( sItem == <span class="stringliteral">"READ_GRIDS"</span> ) <span class="keyword">then</span>
<a name="l01044"></a>01044       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) &amp;
<a name="l01045"></a>01045         <span class="stringliteral">"Reading in grids to be averaged"</span>
<a name="l01046"></a>01046       call Chomp ( sRecord, sArgument )
<a name="l01047"></a>01047       <span class="keyword">if</span>(TRIM(sCalcBasis) == <span class="stringliteral">"ANNUAL"</span>) <span class="keyword">then</span>
<a name="l01048"></a>01048         iCalcBasis = <a class="code" href="namespacegavg.html#b5f98f61f685ba40d5bbb74636447dee">iAVG_ANNUAL</a>
<a name="l01049"></a>01049       elseif(TRIM(sCalcBasis) == <span class="stringliteral">"MONTHLY"</span>) <span class="keyword">then</span>
<a name="l01050"></a>01050         iCalcBasis = <a class="code" href="namespacegavg.html#b323c04f810f58a5099ed4627f73a2d7">iAVG_MONTHLY</a>
<a name="l01051"></a>01051       elseif(TRIM(sCalcBasis) == <span class="stringliteral">"SEASONAL"</span>) <span class="keyword">then</span>
<a name="l01052"></a>01052         iCalcBasis = <a class="code" href="namespacegavg.html#76bd694eb63bacaba20914bbc548ec28">iAVG_SEASONAL</a>
<a name="l01053"></a>01053       <span class="keyword">else</span>
<a name="l01054"></a>01054         call Assert(lFALSE,<span class="stringliteral">"Unknown averaging period specified: "</span> &amp;
<a name="l01055"></a>01055           //TRIM(sArgument),TRIM(__FILE__),__LINE__)
<a name="l01056"></a>01056       <span class="keyword">endif</span>
<a name="l01057"></a>01057 
<a name="l01058"></a>01058       call Assert( <span class="keywordtype">LOGICAL(iBeginYear&lt;=iEndYear,kind=T_LOGICAL)</span>, 
<a name="l01059"></a>01059          <span class="stringliteral">"Ending year must be equal to or greater than the beginning year"</span> )
<a name="l01060"></a>01060 
<a name="l01061"></a>01061       call <a class="code" href="namespacegavg.html#670d4649ecbd919804dd10da333e9c77">gavg_run</a>( pGrd, pConfig, pGraph, sGridFilePrefix, iCalcBasis)
<a name="l01062"></a>01062 
<a name="l01063"></a>01063     <span class="keyword">else</span> <span class="keyword">if</span> ( trim(sItem) == <span class="stringliteral">"EOJ"</span> ) <span class="keyword">then</span>
<a name="l01064"></a>01064 <span class="comment">!      call stats_CalcMeanRecharge(pGrd, pConfig, pGraph)</span>
<a name="l01065"></a>01065 <span class="comment">!      call stats_CalcMeanRechargebyLU(pGrd, pConfig, pGraph)</span>
<a name="l01066"></a>01066       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Job complete."</span>
<a name="l01067"></a>01067       call <a class="code" href="namespacegavg.html#9784e4b4d3dcad7f43693c32f7bedabe">gavg_EndOfRun</a>(pGrd, pConfig)
<a name="l01068"></a>01068       exit
<a name="l01069"></a>01069 
<a name="l01070"></a>01070     <span class="keyword">else</span>
<a name="l01071"></a>01071       call Assert( lFALSE, <span class="stringliteral">"Illegal directive was detected - "</span> // sItem )
<a name="l01072"></a>01072       <span class="keyword">end if</span>
<a name="l01073"></a>01073 
<a name="l01074"></a>01074   <span class="keyword">end do</span> CTL_READ  <span class="comment">! end of control file read loop</span>
<a name="l01075"></a>01075 
<a name="l01076"></a>01076   <span class="keyword">DEALLOCATE</span>(pConfig, STAT=iStat)
<a name="l01077"></a>01077   call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01078"></a>01078      <span class="stringliteral">"Could not deallocate memory for model control data structure"</span>)
<a name="l01079"></a>01079 
<a name="l01080"></a>01080   <span class="keyword">DEALLOCATE</span>(pGraph, STAT=iStat)
<a name="l01081"></a>01081   call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01082"></a>01082      <span class="stringliteral">"Could not deallocate memory for plot control data structure"</span>)
<a name="l01083"></a>01083 
<a name="l01084"></a>01084   <span class="keyword">close</span>(UNIT=LU_CONTROL)
<a name="l01085"></a>01085 
<a name="l01086"></a>01086   return
<a name="l01087"></a>01087 
<a name="l01088"></a>01088 <span class="keyword">end</span> <span class="keyword">subroutine </span>gavg_init
<a name="l01089"></a>01089 
<a name="l01090"></a>01090 <span class="comment">!----------------------------------------------------------------------</span>
<a name="l01091"></a>01091 
<a name="l01092"></a><a class="code" href="namespacegavg.html#670d4649ecbd919804dd10da333e9c77">01092</a> <span class="keyword">subroutine </span>gavg_run( pGrd, pConfig, pGraph , sGridFilePrefix, iCalcBasis)
<a name="l01093"></a>01093 
<a name="l01094"></a>01094   <span class="comment">! [ ARGUMENTS ]</span>
<a name="l01095"></a>01095   <span class="keywordtype">type (</span> T_GENERAL_GRID <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pGrd           <span class="comment">! pointer to model grid</span>
<a name="l01096"></a>01096   <span class="keywordtype">type (</span> T_GENERAL_GRID <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pTmpGrd        <span class="comment">! pointer to gridded data to be averaged</span>
<a name="l01097"></a>01097   <span class="keywordtype">type (</span>T_MODEL_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">pointer</span> :: pConfig  <span class="comment">! pointer to data structure that contains</span>
<a name="l01098"></a>01098                                                     <span class="comment">! model options, flags, and other settings</span>
<a name="l01099"></a>01099 
<a name="l01100"></a>01100   <span class="keywordtype">type (</span>T_GRAPH_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: pGraph
<a name="l01101"></a>01101        <span class="comment">! pointer to data structure that holds parameters for creating</span>
<a name="l01102"></a>01102        <span class="comment">! DISLIN plots</span>
<a name="l01103"></a>01103 
<a name="l01104"></a>01104   <span class="keywordtype">type (</span> T_GENERAL_GRID <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: input_grd        <span class="comment">! pointer to temporary grid</span>
<a name="l01105"></a>01105 
<a name="l01106"></a>01106   <span class="keywordtype">character (len=*)</span>, <span class="keywordtype">intent(in)</span> :: sGridFilePrefix
<a name="l01107"></a>01107   <span class="keywordtype">integer (kind=T_INT) </span>:: iCalcBasis
<a name="l01108"></a>01108 
<a name="l01109"></a>01109   <span class="comment">! [ LOCALS ]</span>
<a name="l01110"></a>01110   <span class="keywordtype">integer (kind=T_INT) </span>:: i, j, k, iStat, iDayOfYear, iMonth
<a name="l01111"></a>01111   <span class="keywordtype">integer (kind=T_INT) </span>:: iDay, iYear, tj, ti
<a name="l01112"></a>01112   <span class="keywordtype">integer (kind=T_INT) </span>:: jj, ii, iNChange, iUpstreamCount, iPasses
<a name="l01113"></a>01113   <span class="keywordtype">integer (kind=T_INT) </span>:: iJulianDay
<a name="l01114"></a>01114   <span class="keywordtype">character(len=3) </span>:: sMonthName
<a name="l01115"></a>01115   <span class="keywordtype">logical (kind=T_LOGICAL) </span>:: lMonthEnd
<a name="l01116"></a>01116   <span class="keywordtype">real (kind=T_SGL) </span>:: rAvgT,rMinT,rMaxT,rPrecip,rRH,rMinRH,rWindSpd,rSunPct
<a name="l01117"></a>01117   <span class="keywordtype">integer (kind=T_INT)</span>,<span class="keywordtype">save</span> :: iNumGridCells
<a name="l01118"></a>01118   <span class="keywordtype">integer (kind=T_INT) </span>:: iNumDaysInYear
<a name="l01119"></a>01119   <span class="keywordtype">integer (kind=T_INT) </span>:: iJD_Begin, iJD_End, iJD_Current
<a name="l01120"></a>01120   <span class="keywordtype">character (len=256) </span>:: sFileType, sStartDate, sEndDate, sCalcBasis
<a name="l01121"></a>01121   <span class="keywordtype">integer (kind=T_INT) </span>:: n
<a name="l01122"></a>01122   <span class="keywordtype">character (len=1) </span>:: sTab = CHAR(9)
<a name="l01123"></a>01123 
<a name="l01124"></a>01124   <span class="keywordtype">real (kind=T_SGL) </span>:: rmin,ravg,rmax
<a name="l01125"></a>01125 
<a name="l01126"></a>01126   <span class="keywordtype">type (</span>T_CELL<span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: cel
<a name="l01127"></a>01127   <span class="keywordtype">character (len=256) </span>:: sBuf, sDate
<a name="l01128"></a>01128 
<a name="l01129"></a>01129   input_grd=&gt;null()
<a name="l01130"></a>01130 
<a name="l01131"></a>01131   pTmpGrd =&gt; <a class="code" href="namespaceswb__grid.html#961bb54be48e77d8d35cb822379f4e60">grid_Create</a>(pGrd%iNX, pGrd%iNY, pGrd%rX0, pGrd%rY0, &amp;
<a name="l01132"></a>01132       pGrd%rX1, pGrd%rY1, T_SGL_GRID)
<a name="l01133"></a>01133 
<a name="l01134"></a>01134   pTmpGrd%rData = rZERO
<a name="l01135"></a>01135 
<a name="l01136"></a>01136   <span class="keyword">if</span>(pConfig%iOutputFormat == OUTPUT_SURFER) <span class="keyword">then</span>
<a name="l01137"></a>01137     sFileType = <span class="stringliteral">"SURFER"</span>
<a name="l01138"></a>01138   <span class="keyword">else</span> <span class="keyword">if</span> (pConfig%iOutputFormat == OUTPUT_ARC) <span class="keyword">then</span>
<a name="l01139"></a>01139     sFileType = <span class="stringliteral">"ARC_GRID"</span>
<a name="l01140"></a>01140   <span class="keyword">else</span>
<a name="l01141"></a>01141     sFileType = <span class="stringliteral">"UNDEFINED"</span>
<a name="l01142"></a>01142   <span class="keyword">end if</span>
<a name="l01143"></a>01143 
<a name="l01144"></a>01144   <span class="keyword">select</span> <span class="keyword">case</span> (iCalcBasis)
<a name="l01145"></a>01145     <span class="keyword">case</span>(iAVG_ANNUAL)
<a name="l01146"></a>01146       sCalcBasis = <span class="stringliteral">"ANNUAL"</span>
<a name="l01147"></a>01147     <span class="keyword">case</span>(iAVG_MONTHLY)
<a name="l01148"></a>01148       sCalcBasis = <span class="stringliteral">"MONTHLY"</span>
<a name="l01149"></a>01149   <span class="keyword">end select</span>
<a name="l01150"></a>01150 
<a name="l01151"></a>01151 
<a name="l01152"></a>01152   call gavg_InitializeSM(pGrd, pConfig )
<a name="l01153"></a>01153 
<a name="l01154"></a>01154     pConfig%iFirstYearforCalculation = pConfig%iFirstYear
<a name="l01155"></a>01155     pConfig%iLastYearforCalculation = pConfig%iLastYear
<a name="l01156"></a>01156 
<a name="l01157"></a>01157   <span class="comment">! create filename for text output</span>
<a name="l01158"></a>01158   <span class="keyword">write</span> ( unit=sBuf, fmt= &amp;
<a name="l01159"></a>01159     <span class="stringliteral">'("output",a,a,"_",a,"_",i4.4,"_",i4.4,".",A)'</span> ) &amp;
<a name="l01160"></a>01160     pConfig%sSlash, trim(sGridFilePrefix), &amp;
<a name="l01161"></a>01161     TRIM(sCalcBasis), &amp;
<a name="l01162"></a>01162     pConfig%iFirstYearforCalculation, &amp;
<a name="l01163"></a>01163     pConfig%iLastYearforCalculation, <span class="stringliteral">"txt"</span>
<a name="l01164"></a>01164 
<a name="l01165"></a>01165   <span class="comment">! open text file for output</span>
<a name="l01166"></a>01166   <span class="keyword">open</span>(unit=LU_CSV, file=TRIM(sBuf),iostat=iStat, status=<span class="stringliteral">"REPLACE"</span>)
<a name="l01167"></a>01167   call Assert(<span class="keywordtype">LOGICAL(iStat==0,kind=T_LOGICAL)</span>, 
<a name="l01168"></a>01168     <span class="stringliteral">"Problem creating CSV output file"</span>,TRIM(__FILE__),__LINE__)
<a name="l01169"></a>01169 
<a name="l01170"></a>01170   <span class="keyword">select</span> <span class="keyword">case</span> (iCalcBasis)
<a name="l01171"></a>01171 
<a name="l01172"></a>01172   <span class="keyword">case</span>(iAVG_ANNUAL)
<a name="l01173"></a>01173 
<a name="l01174"></a>01174     n = pConfig%iLastYearforCalculation - pConfig%iFirstYearforCalculation + 1
<a name="l01175"></a>01175 
<a name="l01176"></a>01176     <span class="keyword">write</span>(sStartDate,FMT=<span class="stringliteral">"(i4)"</span>) pConfig%iFirstYear
<a name="l01177"></a>01177     <span class="keyword">write</span>(sEndDate,FMT=<span class="stringliteral">"(i4)"</span>) pConfig%iLastYear
<a name="l01178"></a>01178 
<a name="l01179"></a>01179     <span class="keyword">do</span> k=pConfig%iFirstYear, pConfig%iLastYear
<a name="l01180"></a>01180 
<a name="l01181"></a>01181       <span class="keyword">write</span> ( unit=sBuf, fmt=<span class="stringliteral">'("output",a,"annual",a,A,"_",i4,".",A)'</span> ) &amp;
<a name="l01182"></a>01182         pConfig%sSlash,pConfig%sSlash, &amp;
<a name="l01183"></a>01183         trim(sGridFilePrefix), k,trim(pConfig%sOutputFileSuffix)
<a name="l01184"></a>01184       input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( sBuf, TRIM(sFileType), T_SGL_GRID )
<a name="l01185"></a>01185       call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, pTmpGrd ), &amp;
<a name="l01186"></a>01186             <span class="stringliteral">"Non-conforming grid - filename: "</span> // sBuf )
<a name="l01187"></a>01187 
<a name="l01188"></a>01188       call <a class="code" href="namespaceswb__stats.html#e5f18911e97e0fc1ba46fc24975f03ed">stats_WriteMinMeanMax</a>( LU_STD_OUT, trim(sGridFilePrefix), &amp;
<a name="l01189"></a>01189          input_grd%rData )
<a name="l01190"></a>01190 
<a name="l01191"></a>01191       call <a class="code" href="namespaceswb__stats.html#e5f18911e97e0fc1ba46fc24975f03ed">stats_WriteMinMeanMax</a>(LU_CSV, trim(sGridFilePrefix)// &amp;
<a name="l01192"></a>01192         sTab//<span class="stringliteral">"ANNUAL"</span>//sTab//int2char(k), input_grd%rData, &amp;
<a name="l01193"></a>01193         COUNT(pGrd%Cells%rSoilWaterCap &gt; rNear_ZERO &amp;
<a name="l01194"></a>01194             .and. pGrd%Cells%iLandUse /= pConfig%iOPEN_WATER_LU))
<a name="l01195"></a>01195 
<a name="l01196"></a>01196       pTmpGrd%rData = pTmpGrd%rData + input_grd%rData
<a name="l01197"></a>01197 
<a name="l01198"></a>01198       call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l01199"></a>01199 
<a name="l01200"></a>01200     <span class="keyword">end do</span>
<a name="l01201"></a>01201 
<a name="l01202"></a>01202     pTmpGrd%rData = pTmpGrd%rData / <span class="keywordtype">REAL</span>(n,kind=T_SGL)
<a name="l01203"></a>01203 
<a name="l01204"></a>01204     call gavg_CalcMean(pGrd, pTmpGrd, pConfig, pGraph, sGridFilePrefix, &amp;
<a name="l01205"></a>01205          <span class="stringliteral">"ENTIRE PERIOD"</span>,sStartDate, sEndDate, iTimeFrame = iANNUAL)
<a name="l01206"></a>01206 
<a name="l01207"></a>01207     call gavg_CalcBasinStats(pGrd, pTmpGrd, pConfig, pGraph, sGridFilePrefix, n)
<a name="l01208"></a>01208 
<a name="l01209"></a>01209   <span class="keyword">case</span>(iAVG_MONTHLY)
<a name="l01210"></a>01210 
<a name="l01211"></a>01211   <span class="comment">! create filename for SERIES text output</span>
<a name="l01212"></a>01212   <span class="keyword">write</span> ( unit=sBuf, fmt= &amp;
<a name="l01213"></a>01213     <span class="stringliteral">'("output",a,a,"_",a,"_",i4.4,"_",i4.4,".",A)'</span> ) &amp;
<a name="l01214"></a>01214     pConfig%sSlash, trim(sGridFilePrefix), &amp;
<a name="l01215"></a>01215     <span class="stringliteral">"MONTHLY_SERIES"</span>, &amp;
<a name="l01216"></a>01216     pConfig%iFirstYearforCalculation, &amp;
<a name="l01217"></a>01217     pConfig%iLastYearforCalculation, <span class="stringliteral">"txt"</span>
<a name="l01218"></a>01218 
<a name="l01219"></a>01219   <span class="comment">! open text file for output</span>
<a name="l01220"></a>01220   <span class="keyword">open</span>(unit=LU_CSV_SERIES, file=TRIM(sBuf),iostat=iStat, status=<span class="stringliteral">"REPLACE"</span>)
<a name="l01221"></a>01221   call Assert(<span class="keywordtype">LOGICAL(iStat==0,kind=T_LOGICAL)</span>, 
<a name="l01222"></a>01222     <span class="stringliteral">"Problem creating CSV output file"</span>,TRIM(__FILE__),__LINE__)
<a name="l01223"></a>01223 
<a name="l01224"></a>01224     n = ( pConfig%iLastYearforCalculation &amp;
<a name="l01225"></a>01225               - pConfig%iFirstYearforCalculation + 1)
<a name="l01226"></a>01226 
<a name="l01227"></a>01227     <span class="keyword">do</span> i=1,12
<a name="l01228"></a>01228 
<a name="l01229"></a>01229       pTmpGrd%rData = rZERO
<a name="l01230"></a>01230 
<a name="l01231"></a>01231       <span class="keyword">do</span> k=pConfig%iFirstYear, pConfig%iLastYear
<a name="l01232"></a>01232 
<a name="l01233"></a>01233         <span class="keyword">write</span>(sDate,FMT=<span class="stringliteral">"(a,a,i4)"</span>) TRIM(YEAR_INFO(i)%sName),sTab,k
<a name="l01234"></a>01234 
<a name="l01235"></a>01235         sStartDate = trim(sDate)
<a name="l01236"></a>01236 
<a name="l01237"></a>01237         <span class="keyword">write</span> ( unit=sBuf, fmt= &amp;
<a name="l01238"></a>01238           <span class="stringliteral">'("output",a,"monthly",a,A,"_",i4,"_",i2.2,".",A)'</span> ) &amp;
<a name="l01239"></a>01239           pConfig%sSlash,pConfig%sSlash, &amp;
<a name="l01240"></a>01240           trim(sGridFilePrefix), k,i,trim(pConfig%sOutputFileSuffix)
<a name="l01241"></a>01241         input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>( TRIM(sBuf), TRIM(sFileType), T_SGL_GRID )
<a name="l01242"></a>01242         call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, pTmpGrd ), &amp;
<a name="l01243"></a>01243               <span class="stringliteral">"Non-conforming grid - filename: "</span> // TRIM(sBuf) )
<a name="l01244"></a>01244 
<a name="l01245"></a>01245         call <a class="code" href="namespaceswb__stats.html#e5f18911e97e0fc1ba46fc24975f03ed">stats_WriteMinMeanMax</a>( LU_STD_OUT, &amp;
<a name="l01246"></a>01246           trim(sGridFilePrefix)//<span class="stringliteral">" "</span>//TRIM(sStartDate), &amp;
<a name="l01247"></a>01247            input_grd%rData )
<a name="l01248"></a>01248 
<a name="l01249"></a>01249   <span class="comment">! test</span>
<a name="l01250"></a>01250 
<a name="l01251"></a>01251         call <a class="code" href="namespaceswb__stats.html#e5f18911e97e0fc1ba46fc24975f03ed">stats_WriteMinMeanMax</a>(LU_CSV_SERIES, trim(sGridFilePrefix)// &amp;
<a name="l01252"></a>01252           sTab//<span class="stringliteral">"MONTHLY MEAN"</span>//sTab//TRIM(sDate), input_grd%rData, &amp;
<a name="l01253"></a>01253           COUNT(pGrd%Cells%rSoilWaterCap &gt; rNear_ZERO &amp;
<a name="l01254"></a>01254               .and. pGrd%Cells%iLandUse /= pConfig%iOPEN_WATER_LU))
<a name="l01255"></a>01255 
<a name="l01256"></a>01256           pTmpGrd%rData = pTmpGrd%rData + input_grd%rData
<a name="l01257"></a>01257 
<a name="l01258"></a>01258           call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>( input_grd )
<a name="l01259"></a>01259 
<a name="l01260"></a>01260       <span class="keyword">end do</span>  <span class="comment">! loop over years</span>
<a name="l01261"></a>01261 
<a name="l01262"></a>01262       <span class="keyword">where</span>(pTmpGrd%rData &gt; rNEAR_ZERO)
<a name="l01263"></a>01263         pTmpGrd%rData = pTmpGrd%rData / <span class="keywordtype">REAL</span>(n,kind=T_SGL)
<a name="l01264"></a>01264       <span class="keyword">end where</span>
<a name="l01265"></a>01265 
<a name="l01266"></a>01266       <span class="keyword">write</span>(sStartDate,FMT=<span class="stringliteral">"(a,'_',i4.4)"</span>) TRIM(YEAR_INFO(i)%sName), &amp;
<a name="l01267"></a>01267         pConfig%iFirstYear
<a name="l01268"></a>01268 
<a name="l01269"></a>01269       <span class="keyword">write</span>(sEndDate,FMT=<span class="stringliteral">"(i4.4)"</span>) pConfig%iLastYear
<a name="l01270"></a>01270 
<a name="l01271"></a>01271       call gavg_CalcMean(pGrd, pTmpGrd, pConfig, pGraph, sGridFilePrefix, &amp;
<a name="l01272"></a>01272            TRIM(YEAR_INFO(i)%sName), sStartDate, sEndDate, iTimeFrame = iMONTHLY)
<a name="l01273"></a>01273 
<a name="l01274"></a>01274       call gavg_CalcMeanbyLU(pGrd, pTmpGrd, pConfig, pGraph, sGridFilePrefix, &amp;
<a name="l01275"></a>01275            sStartDate, sEndDate, iTimeFrame = iMONTHLY)
<a name="l01276"></a>01276 
<a name="l01277"></a>01277     <span class="keyword">end do</span>  <span class="comment">! loop over months</span>
<a name="l01278"></a>01278 
<a name="l01279"></a>01279   <span class="keyword">end select</span>
<a name="l01280"></a>01280 
<a name="l01281"></a>01281 <span class="keyword">end</span> <span class="keyword">subroutine </span>gavg_run
<a name="l01282"></a>01282 
<a name="l01283"></a>01283 <span class="comment">!!***</span>
<a name="l01284"></a>01284 
<a name="l01285"></a>01285 <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l01286"></a>01286 
<a name="l01287"></a><a class="code" href="namespacegavg.html#9784e4b4d3dcad7f43693c32f7bedabe">01287</a> <span class="keyword">subroutine </span>gavg_EndOfRun(pGrd, pConfig)
<a name="l01288"></a>01288 
<a name="l01289"></a>01289   <span class="comment">![ARGUMENTS]</span>
<a name="l01290"></a>01290   <span class="keywordtype">type (</span>T_GENERAL_GRID<span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pGrd      <span class="comment">! Grid of model cells</span>
<a name="l01291"></a>01291   <span class="keywordtype">type (</span>T_MODEL_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">pointer</span> :: pConfig  <span class="comment">! pointer to data structure that contains</span>
<a name="l01292"></a>01292                                                     <span class="comment">! model options, flags, and other settings</span>
<a name="l01293"></a>01293   <span class="comment">![LOCALS]</span>
<a name="l01294"></a>01294   <span class="keywordtype">integer (kind=T_INT) </span>:: iNX, iNY        <span class="comment">! Grid dimensions</span>
<a name="l01295"></a>01295   <span class="keywordtype">real (kind=T_DBL) </span>:: rX0, rY0          <span class="comment">! Lower-left corner (world coords)</span>
<a name="l01296"></a>01296   <span class="keywordtype">real (kind=T_DBL) </span>:: rX1, rY1          <span class="comment">! Upper-right corner (world coords)</span>
<a name="l01297"></a>01297 
<a name="l01298"></a>01298   <span class="comment">! preserve grid dimensions before destroying model grid data structure</span>
<a name="l01299"></a>01299   iNX = pGrd%iNX
<a name="l01300"></a>01300   iNY = pGrd%iNY
<a name="l01301"></a>01301   rX0 = pGrd%rX0
<a name="l01302"></a>01302   rY0 = pGrd%rY0
<a name="l01303"></a>01303   rX1 = pGrd%rX1
<a name="l01304"></a>01304   rY1 = pGrd%rY1
<a name="l01305"></a>01305 
<a name="l01306"></a>01306   <span class="comment">! destroy model grid to free up memory</span>
<a name="l01307"></a>01307   call <a class="code" href="namespaceswb__grid.html#42bbda135d21221339b4b6656da28933">grid_Destroy</a>(pGrd)
<a name="l01308"></a>01308 
<a name="l01309"></a>01309   <span class="comment">! How long did all this take, anyway?</span>
<a name="l01310"></a>01310   call cpu_time(rEndTime)
<a name="l01311"></a>01311   print <span class="stringliteral">"(//1x,"</span><span class="stringliteral">"Run time: "</span><span class="stringliteral">", f10.2, "</span><span class="stringliteral">" minutes"</span><span class="stringliteral">")"</span>,(rEndTime-rStartTime)/60.0_T_SGL
<a name="l01312"></a>01312 
<a name="l01313"></a>01313   return
<a name="l01314"></a>01314 <span class="keyword">end</span> <span class="keyword">subroutine </span>gavg_EndOfRun
<a name="l01315"></a>01315 
<a name="l01316"></a>01316 <span class="comment">!----------------------------------------------------------------------</span>
<a name="l01317"></a><a class="code" href="namespacegavg.html#d03f95b5e8a08d1d251a3b3a7b23a74b">01317</a> <span class="keyword">subroutine </span>gavg_CalcBasinStats(pGrd, pTmpGrd, pConfig, pGraph, sOutputFilePrefix, n)
<a name="l01318"></a>01318 
<a name="l01319"></a>01319   <span class="keywordtype">type (</span>T_GENERAL_GRID<span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pGrd            <span class="comment">! pointer to model grid</span>
<a name="l01320"></a>01320   <span class="keywordtype">type (</span>T_GENERAL_GRID<span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pTmpGrd         <span class="comment">! pointer to results grid</span>
<a name="l01321"></a>01321   <span class="keywordtype">type (</span>T_MODEL_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">pointer</span> :: pConfig <span class="comment">! pointer to data structure that contains</span>
<a name="l01322"></a>01322                                                    <span class="comment">! model options, flags, and other settings</span>
<a name="l01323"></a>01323   <span class="keywordtype">type (</span>T_GRAPH_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: pGraph
<a name="l01324"></a>01324      <span class="comment">! pointer to data structure that holds parameters for creating</span>
<a name="l01325"></a>01325      <span class="comment">! DISLIN plots</span>
<a name="l01326"></a>01326 
<a name="l01327"></a>01327   <span class="keywordtype">character(len=*) </span>:: sOutputFilePrefix
<a name="l01328"></a>01328   <span class="keywordtype">integer(kind=T_INT) </span>:: n
<a name="l01329"></a>01329 
<a name="l01330"></a>01330   <span class="comment">![LOCALS]</span>
<a name="l01331"></a>01331   <span class="keywordtype">type (</span> T_LANDUSE_LOOKUP <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pLU  <span class="comment">! pointer to landuse data structure</span>
<a name="l01332"></a>01332 
<a name="l01333"></a>01333   <span class="keywordtype">integer (kind=T_INT) </span>:: j, k, iStat, iCount, iMajorityLU, iMajoritySoil
<a name="l01334"></a>01334   <span class="keywordtype">integer (kind=T_INT) </span>::  iLU_Max, iSoil_Max, iNumGridCells
<a name="l01335"></a>01335   <span class="keywordtype">real (kind=T_SGL) </span>:: rSum, rAvg, rMin, rMax
<a name="l01336"></a>01336 
<a name="l01337"></a>01337   <span class="keywordtype">character (len=256) </span>:: sBuf
<a name="l01338"></a>01338   <span class="keywordtype">character (len=1) </span>:: sTab = CHAR(9)
<a name="l01339"></a>01339 
<a name="l01340"></a>01340   <span class="keywordtype">type (</span>T_GENERAL_GRID<span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: input_grd    <span class="comment">! Pointer to temporary grid for I/O</span>
<a name="l01341"></a>01341 
<a name="l01342"></a>01342   <span class="keyword">write</span>(sBuf,FMT=<span class="stringliteral">"('BASIN_STATS_',A,'.txt')"</span>) trim(sOutputFilePrefix)
<a name="l01343"></a>01343 
<a name="l01344"></a>01344   <span class="keyword">open</span>(UNIT=LU_MASK_STATS_CSV,FILE=trim(sBuf),iostat=iStat,STATUS=<span class="stringliteral">'REPLACE'</span>)
<a name="l01345"></a>01345   call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01346"></a>01346     <span class="stringliteral">"Could not open basin mask statistics file"</span>)
<a name="l01347"></a>01347 
<a name="l01348"></a>01348   <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">"Number of grids in averaging procedure:"</span>,n
<a name="l01349"></a>01349 
<a name="l01350"></a>01350   <span class="keyword">write</span>(UNIT=LU_MASK_STATS_CSV,FMT=*) <span class="stringliteral">"USGS_UpstreamOrderNum,"</span> &amp;
<a name="l01351"></a>01351     //sTab//<span class="stringliteral">"Basin_Description"</span>//sTab//<span class="stringliteral">"Drainage_area"</span>//sTab &amp;
<a name="l01352"></a>01352     //<span class="stringliteral">"Majority Land Use"</span>//sTab//<span class="stringliteral">"Majority Soil Type"</span>//sTab &amp;
<a name="l01353"></a>01353     //<span class="stringliteral">"SWB_Mean_Recharge"</span>//sTab//<span class="stringliteral">"SWB_Min_Recharge"</span>//sTab &amp;
<a name="l01354"></a>01354     //<span class="stringliteral">"SWB_Max_Recharge"</span>//sTab//<span class="stringliteral">"Baseflow_Recharge"</span>
<a name="l01355"></a>01355 
<a name="l01356"></a>01356   <span class="keyword">do</span> k = 1,<span class="keyword">size</span>(pConfig%BMASK,1)
<a name="l01357"></a>01357 
<a name="l01358"></a>01358     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) k,<span class="stringliteral">" : Attempting to read mask file: "</span>, &amp;
<a name="l01359"></a>01359        TRIM(pConfig%BMASK(k)%sBasinMaskFilename)
<a name="l01360"></a>01360     input_grd =&gt; <a class="code" href="namespaceswb__grid.html#99ec16225afef63a0e34f4882ee3250f">grid_Read</a>(TRIM(pConfig%BMASK(k)%sBasinMaskFilename), <span class="stringliteral">"ARC_GRID"</span>, T_SGL_GRID )
<a name="l01361"></a>01361     call Assert( <a class="code" href="namespaceswb__grid.html#da2d0ba491d29a4a52aae2822b888f1f">grid_Conform</a>( pGrd, input_grd ), &amp;
<a name="l01362"></a>01362               <span class="stringliteral">"Non-conforming grid - filename: "</span> // TRIM(pConfig%BMASK(k)%sBasinMaskFilename))
<a name="l01363"></a>01363 
<a name="l01364"></a>01364     iCount = COUNT(input_grd%rData&gt;0)
<a name="l01365"></a>01365 
<a name="l01366"></a>01366     <span class="comment">! sum of the sum of annual recharge values</span>
<a name="l01367"></a>01367     rSum = SUM(pTmpGrd%rData,MASK=input_grd%rData&gt;0)
<a name="l01368"></a>01368     rMax = MAXVAL(pTmpGrd%rData,MASK=input_grd%rData&gt;0)
<a name="l01369"></a>01369     rMin = MINVAL(pTmpGrd%rData,MASK=input_grd%rData&gt;0)
<a name="l01370"></a>01370 
<a name="l01371"></a>01371     rAvg = rSum / iCount
<a name="l01372"></a>01372 
<a name="l01373"></a>01373     iMajorityLU = 0
<a name="l01374"></a>01374     iMajoritySoil = 0
<a name="l01375"></a>01375     iLU_Max = 0
<a name="l01376"></a>01376     iSoil_Max = 0
<a name="l01377"></a>01377 
<a name="l01378"></a>01378     <span class="comment">! iterate through all land use types</span>
<a name="l01379"></a>01379     <span class="keyword">do</span> j = 1,<span class="keyword">size</span>(pConfig%LU,1)
<a name="l01380"></a>01380 
<a name="l01381"></a>01381         <span class="comment">! establish number of cells in model grid</span>
<a name="l01382"></a>01382         iNumGridCells = COUNT( &amp;
<a name="l01383"></a>01383           INT(pGrd%Cells%iLanduse,kind=T_INT)==pConfig%LU(j)%iLandUseType &amp;
<a name="l01384"></a>01384           .and. input_grd%rData&gt;0 )
<a name="l01385"></a>01385 
<a name="l01386"></a>01386         <span class="keyword">if</span>(iNumGridCells&gt;iLU_Max) <span class="keyword">then</span>
<a name="l01387"></a>01387           iLU_Max = iNumGridCells
<a name="l01388"></a>01388           iMajorityLU = j
<a name="l01389"></a>01389         <span class="keyword">end if</span>
<a name="l01390"></a>01390 
<a name="l01391"></a>01391     <span class="keyword">end do</span>
<a name="l01392"></a>01392 
<a name="l01393"></a>01393     <span class="keyword">do</span> j=1,maxval(INT(pGrd%Cells%iSoilGroup,kind=T_INT))
<a name="l01394"></a>01394 
<a name="l01395"></a>01395       <span class="comment">! establish number of cells in model grid for THIS combination</span>
<a name="l01396"></a>01396       iNumGridCells = COUNT( &amp;
<a name="l01397"></a>01397         INT(pGrd%Cells%iSoilGroup,kind=T_INT)==j &amp;
<a name="l01398"></a>01398           .and. input_grd%rData&gt;0 )
<a name="l01399"></a>01399 
<a name="l01400"></a>01400         <span class="keyword">if</span>(iNumGridCells&gt;iSoil_Max) <span class="keyword">then</span>
<a name="l01401"></a>01401           iSoil_Max = iNumGridCells
<a name="l01402"></a>01402           iMajoritySoil = j
<a name="l01403"></a>01403         <span class="keyword">end if</span>
<a name="l01404"></a>01404 
<a name="l01405"></a>01405     <span class="keyword">end do</span>
<a name="l01406"></a>01406 
<a name="l01407"></a>01407     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=<span class="stringliteral">"(A)"</span>) <span class="stringliteral">""</span>
<a name="l01408"></a>01408     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=<span class="stringliteral">"(5x,A)"</span>) TRIM(pConfig%BMASK(k)%sBasinDescription)
<a name="l01409"></a>01409     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=<span class="stringliteral">"(5x,'Drainage area (sq mi):', f14.2)"</span>) &amp;
<a name="l01410"></a>01410         pConfig%BMASK(k)%rDrainageArea
<a name="l01411"></a>01411     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=<span class="stringliteral">"(5x,'Majority Land Use Type:',a)"</span>) &amp;
<a name="l01412"></a>01412         TRIM(pConfig%LU(iMajorityLU)%sLanduseDescription)
<a name="l01413"></a>01413     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=<span class="stringliteral">"(5x,'Majority Soil Type:',i4)"</span>) &amp;
<a name="l01414"></a>01414         iMajoritySoil
<a name="l01415"></a>01415     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=<span class="stringliteral">"(8x,A7,i12)"</span>) <span class="stringliteral">"count:"</span>,iCount
<a name="l01416"></a>01416     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=<span class="stringliteral">"(8x,A7,f14.2)"</span>) <span class="stringliteral">"sum:"</span>,rSum
<a name="l01417"></a>01417     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=<span class="stringliteral">"(8x,2(A7,f14.2))"</span>) <span class="stringliteral">"avg:"</span>,rAvg,<span class="stringliteral">"Qb:"</span>,pConfig%BMASK(k)%rQb
<a name="l01418"></a>01418     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=<span class="stringliteral">"(A)"</span>) REPEAT(<span class="stringliteral">"-"</span>,80)
<a name="l01419"></a>01419     <span class="keyword">write</span>(UNIT=LU_MASK_STATS_CSV,FMT=<span class="stringliteral">"(A,a,A,a,f16.4,3a,i4,a,4(f16.4,a)))"</span>) &amp;
<a name="l01420"></a>01420        TRIM(pConfig%BMASK(k)%sUSGS_UpstreamOrderID),sTab, &amp;
<a name="l01421"></a>01421        TRIM(pConfig%BMASK(k)%sBasinDescription),sTab, &amp;
<a name="l01422"></a>01422        pConfig%BMASK(k)%rDrainageArea,sTab, &amp;
<a name="l01423"></a>01423        TRIM(pConfig%LU(iMajorityLU)%sLanduseDescription), sTab,iMajoritySoil, sTab,&amp;
<a name="l01424"></a>01424        rAvg,sTab,rMin,sTab,rMax,sTab,pConfig%BMASK(k)%rQb
<a name="l01425"></a>01425 
<a name="l01426"></a>01426     <span class="keyword">close</span>(UNIT=LU_MASK_FILE)
<a name="l01427"></a>01427 
<a name="l01428"></a>01428   <span class="keyword">end do</span>
<a name="l01429"></a>01429 
<a name="l01430"></a>01430   flush(UNIT=LU_MASK_STATS_CSV)
<a name="l01431"></a>01431 
<a name="l01432"></a>01432   <span class="keyword">close</span>(UNIT=LU_MASK_STATS_CSV)
<a name="l01433"></a>01433 
<a name="l01434"></a>01434 
<a name="l01435"></a>01435 <span class="keyword">end</span> <span class="keyword">subroutine </span>gavg_CalcBasinStats
<a name="l01436"></a>01436 
<a name="l01437"></a>01437 <span class="comment">!----------------------------------------------------------------------</span>
<a name="l01438"></a>01438 
<a name="l01439"></a><a class="code" href="namespacegavg.html#84d88e3191e23bf9ab9e6bbc2cd5d40b">01439</a> <span class="keyword">subroutine </span>gavg_CalcMean(pGrd, pTmpGrd, pConfig, pGraph, sGridFilePrefix, &amp;
<a name="l01440"></a>01440   sTimeFrame, sStartDate, sEndDate, iTimeFrame)
<a name="l01441"></a>01441 
<a name="l01442"></a>01442   <span class="keywordtype">type (</span>T_GENERAL_GRID<span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pGrd            <span class="comment">! pointer to model grid</span>
<a name="l01443"></a>01443   <span class="keywordtype">type (</span> T_GENERAL_GRID <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pTmpGrd       <span class="comment">! pointer to grid of data to be averaged</span>
<a name="l01444"></a>01444   <span class="keywordtype">type (</span>T_MODEL_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">pointer</span> :: pConfig <span class="comment">! pointer to data structure that contains</span>
<a name="l01445"></a>01445                                                    <span class="comment">! model options, flags, and other settings</span>
<a name="l01446"></a>01446   <span class="keywordtype">type (</span>T_GRAPH_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: pGraph
<a name="l01447"></a>01447   <span class="keywordtype">character (len=*) </span>:: sGridFilePrefix
<a name="l01448"></a>01448   <span class="keywordtype">character(len=*) </span>:: sTimeFrame
<a name="l01449"></a>01449   <span class="keywordtype">character(len=*) </span>:: sStartDate
<a name="l01450"></a>01450   <span class="keywordtype">character(len=*) </span>:: sEndDate
<a name="l01451"></a>01451   <span class="keywordtype">integer (kind=T_INT) </span>:: iTimeFrame
<a name="l01452"></a>01452   <span class="keywordtype">character(len=1) </span>:: sTab = ACHAR(9)
<a name="l01453"></a>01453      <span class="comment">! pointer to data structure that holds parameters for creating</span>
<a name="l01454"></a>01454      <span class="comment">! DISLIN plots</span>
<a name="l01455"></a>01455 
<a name="l01456"></a>01456   <span class="comment">! [ LOCALS ]</span>
<a name="l01457"></a>01457   <span class="keywordtype">integer (kind=T_INT) </span>:: k
<a name="l01458"></a>01458 
<a name="l01459"></a>01459   <span class="keywordtype">character (len=256) </span>:: sBuf
<a name="l01460"></a>01460   <span class="keywordtype">character (len=256) </span>:: sModifier = <span class="stringliteral">"Annual"</span>
<a name="l01461"></a>01461 
<a name="l01462"></a>01462   <span class="keyword">write</span>(LU_LOG, FMT=<span class="stringliteral">"(a,a,' to ',a,': ')"</span>) &amp;
<a name="l01463"></a>01463     <span class="stringliteral">"Mean "</span>//trim(sGridFilePrefix)//<span class="stringliteral">" over period "</span>, &amp;
<a name="l01464"></a>01464     trim(sStartDate),trim(sEndDate)
<a name="l01465"></a>01465 
<a name="l01466"></a>01466   call <a class="code" href="namespaceswb__stats.html#e5f18911e97e0fc1ba46fc24975f03ed">stats_WriteMinMeanMax</a>(LU_LOG, <span class="stringliteral">"MEAN "</span>//trim(sGridFilePrefix), &amp;
<a name="l01467"></a>01467           pTmpGrd%rData)
<a name="l01468"></a>01468 
<a name="l01469"></a>01469   call <a class="code" href="namespaceswb__stats.html#e5f18911e97e0fc1ba46fc24975f03ed">stats_WriteMinMeanMax</a>(LU_CSV, trim(sGridFilePrefix)// &amp;
<a name="l01470"></a>01470     sTab//trim(sTimeFrame)//sTab// &amp;
<a name="l01471"></a>01471     TRIM(int2char(pConfig%iFirstYearforCalculation)) &amp;
<a name="l01472"></a>01472     //sTab//TRIM(int2char(pConfig%iLastYearforCalculation)), &amp;
<a name="l01473"></a>01473     pTmpGrd%rData, COUNT(pGrd%Cells%rSoilWaterCap &gt; rNear_ZERO &amp;
<a name="l01474"></a>01474             .and. pGrd%Cells%iLandUse /= pConfig%iOPEN_WATER_LU))
<a name="l01475"></a>01475 
<a name="l01476"></a>01476   <span class="keyword">write</span>(LU_LOG,&amp;
<a name="l01477"></a>01477    FMT=<span class="stringliteral">"('MEAN ',A,', EXCLUDING OPEN WATER CELLS:',f14.3)"</span>) &amp;
<a name="l01478"></a>01478     trim(sGridFilePrefix), &amp;
<a name="l01479"></a>01479     SUM(pTmpGrd%rData,pGrd%Cells%rSoilWaterCap &gt; rNear_ZERO &amp;
<a name="l01480"></a>01480             .and. pGrd%Cells%iLandUse /= pConfig%iOPEN_WATER_LU) / &amp;
<a name="l01481"></a>01481     COUNT(pGrd%Cells%rSoilWaterCap &gt; rNear_ZERO &amp;
<a name="l01482"></a>01482             .and. pGrd%Cells%iLandUse /= pConfig%iOPEN_WATER_LU)
<a name="l01483"></a>01483 
<a name="l01484"></a>01484   flush(LU_LOG)
<a name="l01485"></a>01485 
<a name="l01486"></a>01486   <span class="keyword">write</span>(sBuf,FMT=<span class="stringliteral">"('output',a,'MEAN_',a,'_',a,'_',a,'.asc')"</span>) &amp;
<a name="l01487"></a>01487     pConfig%sSlash, &amp;
<a name="l01488"></a>01488     trim(sGridFilePrefix),trim(sStartDate), trim(sEndDate)
<a name="l01489"></a>01489   call <a class="code" href="namespaceswb__grid.html#9d60759cd038c3d1936d912299e2f4a2">grid_WriteArcGrid</a>(sBuf,pGrd%rX0,pGrd%rX1,pGrd%rY0,pGrd%rY1, &amp;
<a name="l01490"></a>01490       pTmpGrd%rData)
<a name="l01491"></a>01491 
<a name="l01492"></a>01492 
<a name="l01493"></a>01493   <span class="keyword">write</span>(sBuf,FMT=<span class="stringliteral">"('images',a,'MEAN_',a,'_',a,'_',a,a)"</span>) &amp;
<a name="l01494"></a>01494     pConfig%sSlash, &amp;
<a name="l01495"></a>01495     trim(sGridFilePrefix),trim(sStartDate), trim(sEndDate), &amp;
<a name="l01496"></a>01496     <span class="stringliteral">"."</span>//TRIM(pGraph(iRECHARGE)%cCDEV)
<a name="l01497"></a>01497   pGraph(iRECHARGE)%cSETFIL = TRIM(sBuf)
<a name="l01498"></a>01498 
<a name="l01499"></a>01499   <span class="keyword">if</span>(trim(sTimeFrame) /= <span class="stringliteral">"ANNUAL"</span> .and. &amp;
<a name="l01500"></a>01500     trim(sTimeFrame) /= <span class="stringliteral">"ENTIRE PERIOD"</span>) sModifier = <span class="stringliteral">"Monthly"</span>
<a name="l01501"></a>01501 
<a name="l01502"></a>01502 
<a name="l01503"></a>01503   <span class="keyword">write</span>(sBuf,FMT=<span class="stringliteral">"('Mean ',A,1x,A,1x,a,1x,a,'-',a)"</span>) &amp;
<a name="l01504"></a>01504     trim(sModifier), &amp;
<a name="l01505"></a>01505     trim(sGridFilePrefix),trim(sTimeFrame), &amp;
<a name="l01506"></a>01506     trim(int2char(pConfig%iFirstYearforCalculation)), &amp;
<a name="l01507"></a>01507     trim(int2char(pConfig%iLastYearforCalculation))
<a name="l01508"></a>01508 
<a name="l01509"></a>01509   pGraph(iRECHARGE)%cTITLE = TRIM(sBuf)
<a name="l01510"></a>01510   pGraph(iRECHARGE)%iTimeFrame = iTimeFrame
<a name="l01511"></a>01511   call <a class="code" href="namespacegraph.html#0d0898b2db62366093b9d8785a1b9d90">makegraph</a>(pGraph,pTmpGrd,iRECHARGE)
<a name="l01512"></a>01512 
<a name="l01513"></a>01513   <span class="keyword">write</span>(LU_LOG,FMT=*) REPEAT(<span class="stringliteral">"-"</span>,80)
<a name="l01514"></a>01514 
<a name="l01515"></a>01515   return
<a name="l01516"></a>01516 
<a name="l01517"></a>01517 <span class="keyword">end</span> <span class="keyword">subroutine </span>gavg_CalcMean
<a name="l01518"></a>01518 <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l01519"></a>01519 
<a name="l01520"></a><a class="code" href="namespacegavg.html#086ca9767278891e29118f962c9b93b7">01520</a> <span class="keyword">subroutine </span>gavg_CalcMeanbyLU(pGrd, pTmpGrd, pConfig, pGraph, sGridFilePrefix, &amp;
<a name="l01521"></a>01521   sStartDate, sEndDate, iTimeFrame)
<a name="l01522"></a>01522 
<a name="l01523"></a>01523   <span class="keywordtype">type (</span>T_GENERAL_GRID<span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pGrd            <span class="comment">! pointer to model grid</span>
<a name="l01524"></a>01524   <span class="keywordtype">type (</span> T_GENERAL_GRID <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pTmpGrd       <span class="comment">! pointer to grid of data to be averaged</span>
<a name="l01525"></a>01525   <span class="keywordtype">type (</span>T_MODEL_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">pointer</span> :: pConfig <span class="comment">! pointer to data structure that contains</span>
<a name="l01526"></a>01526                                                    <span class="comment">! model options, flags, and other settings</span>
<a name="l01527"></a>01527   <span class="keywordtype">type (</span>T_GRAPH_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: pGraph
<a name="l01528"></a>01528   <span class="keywordtype">character (len=*) </span>:: sGridFilePrefix
<a name="l01529"></a>01529   <span class="keywordtype">character(len=*) </span>:: sStartDate
<a name="l01530"></a>01530   <span class="keywordtype">character(len=*) </span>:: sEndDate
<a name="l01531"></a>01531   <span class="keywordtype">integer (kind=T_INT) </span>:: iTimeFrame
<a name="l01532"></a>01532 
<a name="l01533"></a>01533   <span class="comment">![LOCALS]</span>
<a name="l01534"></a>01534   <span class="keywordtype">type (</span> T_LANDUSE_LOOKUP <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pLU  <span class="comment">! pointer to landuse data structure</span>
<a name="l01535"></a>01535   <span class="keywordtype">integer (kind=T_INT) </span>:: iNumGridCells
<a name="l01536"></a>01536 
<a name="l01537"></a>01537   <span class="keywordtype">integer (kind=T_INT) </span>:: i,k
<a name="l01538"></a>01538 
<a name="l01539"></a>01539   <span class="keywordtype">character (len=256) </span>:: sBuf
<a name="l01540"></a>01540 
<a name="l01541"></a>01541   <span class="keyword">write</span>(LU_LOG, FMT=<span class="stringliteral">"(a,a,',',a,' to ',a,': ')"</span>) &amp;
<a name="l01542"></a>01542     <span class="stringliteral">"Mean "</span>//trim(sGridFilePrefix)//<span class="stringliteral">" over period "</span>, &amp;
<a name="l01543"></a>01543     trim(sStartDate),trim(sEndDate)
<a name="l01544"></a>01544 
<a name="l01545"></a>01545   <span class="comment">! iterate through all land use types</span>
<a name="l01546"></a>01546   <span class="keyword">do</span> k = 1,<span class="keyword">size</span>(pConfig%LU,1)
<a name="l01547"></a>01547 
<a name="l01548"></a>01548         <span class="comment">!create pointer to a specific land use type</span>
<a name="l01549"></a>01549         pLU =&gt; pConfig%LU(k)
<a name="l01550"></a>01550                 call Assert(<span class="keywordtype">LOGICAL(associated(pLU)</span>,kind=T_LOGICAL), 
<a name="l01551"></a>01551                    <span class="stringliteral">"pointer association failed - stats - CalcMeanRechargebyLU"</span>)
<a name="l01552"></a>01552 
<a name="l01553"></a>01553       <span class="comment">! establish number of cells that have this landuse code</span>
<a name="l01554"></a>01554       iNumGridCells = COUNT( &amp;
<a name="l01555"></a>01555         INT(pGrd%Cells%iLanduse,kind=T_INT)==pLU%iLandUseType )
<a name="l01556"></a>01556 
<a name="l01557"></a>01557       <span class="keyword">if</span>(iNumGridCells&gt;0) <span class="keyword">then</span>
<a name="l01558"></a>01558 
<a name="l01559"></a>01559         <span class="keyword">write</span>(LU_LOG,<span class="stringliteral">"(a30,3(f12.2,2x))"</span>) &amp;
<a name="l01560"></a>01560           adjustl(pLU%sLandUseDescription), &amp;
<a name="l01561"></a>01561           minval(pTmpGrd%rData, &amp;
<a name="l01562"></a>01562           INT(pGrd%Cells%iLanduse,kind=T_INT)==pLU%iLandUseType ), &amp;
<a name="l01563"></a>01563           sum(pTmpGrd%rData, &amp;
<a name="l01564"></a>01564           INT(pGrd%Cells%iLanduse,kind=T_INT)==pLU%iLandUseType ) &amp;
<a name="l01565"></a>01565              /iNumGridCells, &amp;
<a name="l01566"></a>01566           maxval(pTmpGrd%rData, &amp;
<a name="l01567"></a>01567           INT(pGrd%Cells%iLanduse,kind=T_INT)==pLU%iLandUseType )
<a name="l01568"></a>01568 
<a name="l01569"></a>01569       <span class="keyword">else</span>
<a name="l01570"></a>01570 
<a name="l01571"></a>01571         <span class="keyword">write</span>(LU_LOG,<span class="stringliteral">"(a30)"</span>) &amp;
<a name="l01572"></a>01572           adjustl(pLU%sLandUseDescription)
<a name="l01573"></a>01573 
<a name="l01574"></a>01574       <span class="keyword">end if</span>
<a name="l01575"></a>01575 
<a name="l01576"></a>01576       flush(LU_LOG)
<a name="l01577"></a>01577 
<a name="l01578"></a>01578   <span class="keyword">end do</span>
<a name="l01579"></a>01579 
<a name="l01580"></a>01580   <span class="keyword">write</span>(LU_LOG, FMT=*) <span class="stringliteral">""</span>
<a name="l01581"></a>01581   <span class="keyword">write</span>(LU_LOG, FMT=<span class="stringliteral">"(a,a,'-',a,':')"</span>) &amp;
<a name="l01582"></a>01582     <span class="stringliteral">"Average recharge by landuse and soil type over period "</span>, &amp;
<a name="l01583"></a>01583     sStartDate, sEndDate
<a name="l01584"></a>01584 
<a name="l01585"></a>01585 
<a name="l01586"></a>01586   <span class="keyword">write</span>(LU_LOG,<span class="stringliteral">"(a30,' Soil Type ',4(a12,2x))"</span>) &amp;
<a name="l01587"></a>01587     <span class="stringliteral">"Land Use"</span>, <span class="stringliteral">"Min (in)"</span>,<span class="stringliteral">"Mean (in)"</span>,<span class="stringliteral">"Max (in)"</span>,<span class="stringliteral">"Count"</span>
<a name="l01588"></a>01588 
<a name="l01589"></a>01589   <span class="comment">! Now iterate through all land use types *AND* soil types</span>
<a name="l01590"></a>01590   <span class="keyword">do</span> k = 1,<span class="keyword">size</span>(pConfig%LU,1)
<a name="l01591"></a>01591 
<a name="l01592"></a>01592     <span class="keyword">do</span> i=1,maxval(INT(pGrd%Cells%iSoilGroup,kind=T_INT))
<a name="l01593"></a>01593 
<a name="l01594"></a>01594         <span class="comment">!create pointer to a specific land use type</span>
<a name="l01595"></a>01595         pLU =&gt; pConfig%LU(k)
<a name="l01596"></a>01596                 call Assert(<span class="keywordtype">LOGICAL(associated(pLU)</span>,kind=T_LOGICAL), 
<a name="l01597"></a>01597                    <span class="stringliteral">"pointer association failed - stats - CalcMeanRechargebyLU"</span>)
<a name="l01598"></a>01598 
<a name="l01599"></a>01599       <span class="comment">! establish number of cells in model grid for THIS combination</span>
<a name="l01600"></a>01600       iNumGridCells = COUNT( &amp;
<a name="l01601"></a>01601         INT(pGrd%Cells%iLanduse,kind=T_INT)==pLU%iLandUseType &amp;
<a name="l01602"></a>01602            .and. INT(pGrd%Cells%iSoilGroup,kind=T_INT)==i)
<a name="l01603"></a>01603 
<a name="l01604"></a>01604       <span class="keyword">if</span>(iNumGridCells&gt;0) <span class="keyword">then</span>
<a name="l01605"></a>01605 
<a name="l01606"></a>01606         <span class="keyword">write</span>(LU_LOG,<span class="stringliteral">"(a30,' Soil:',i2,'| ',3(f12.2,2x),i12)"</span>) &amp;
<a name="l01607"></a>01607           adjustl(pLU%sLandUseDescription), &amp;
<a name="l01608"></a>01608           i, &amp;
<a name="l01609"></a>01609           minval(pTmpGrd%rData, &amp;
<a name="l01610"></a>01610           INT(pGrd%Cells%iLanduse,kind=T_INT)==pLU%iLandUseType  &amp;
<a name="l01611"></a>01611            .and. INT(pGrd%Cells%iSoilGroup,kind=T_INT)==i), &amp;
<a name="l01612"></a>01612           sum(pTmpGrd%rData, &amp;
<a name="l01613"></a>01613           INT(pGrd%Cells%iLanduse,kind=T_INT)==pLU%iLandUseType  &amp;
<a name="l01614"></a>01614            .and. INT(pGrd%Cells%iSoilGroup,kind=T_INT)==i) &amp;
<a name="l01615"></a>01615              /iNumGridCells, &amp;
<a name="l01616"></a>01616           maxval(pTmpGrd%rData, &amp;
<a name="l01617"></a>01617           INT(pGrd%Cells%iLanduse,kind=T_INT)==pLU%iLandUseType  &amp;
<a name="l01618"></a>01618            .and. INT(pGrd%Cells%iSoilGroup,kind=T_INT)==i), &amp;
<a name="l01619"></a>01619           iNumGridCells
<a name="l01620"></a>01620 
<a name="l01621"></a>01621 
<a name="l01622"></a>01622         <span class="keyword">else</span>
<a name="l01623"></a>01623 
<a name="l01624"></a>01624           <span class="keyword">write</span>(LU_LOG,<span class="stringliteral">"(a30,' Soil:',i2,'| ')"</span>) &amp;
<a name="l01625"></a>01625            adjustl(pLU%sLandUseDescription), i
<a name="l01626"></a>01626 
<a name="l01627"></a>01627         <span class="keyword">end if</span>
<a name="l01628"></a>01628 
<a name="l01629"></a>01629         flush(LU_LOG)
<a name="l01630"></a>01630 
<a name="l01631"></a>01631     <span class="keyword">end do</span>
<a name="l01632"></a>01632 
<a name="l01633"></a>01633   <span class="keyword">end do</span>
<a name="l01634"></a>01634 
<a name="l01635"></a>01635   <span class="keyword">write</span>(LU_LOG,FMT=*) REPEAT(<span class="stringliteral">"-"</span>,80)
<a name="l01636"></a>01636 
<a name="l01637"></a>01637   return
<a name="l01638"></a>01638 
<a name="l01639"></a>01639 <span class="keyword">end</span> <span class="keyword">subroutine </span>gavg_CalcMeanbyLU
<a name="l01640"></a>01640 <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l01641"></a>01641 
<a name="l01642"></a><a class="code" href="namespacegavg.html#1537d267d3b9e6b631686ac48055f21d">01642</a> <span class="keyword">subroutine </span>gavg_InitializeSM(pGrd, pConfig )
<a name="l01643"></a>01643   <span class="comment">!! Depending on the SM model in use, computes the change in soil moisture</span>
<a name="l01644"></a>01644   <span class="comment">!! and also the recharge (if any) for each cell in the grid, given the</span>
<a name="l01645"></a>01645   <span class="comment">!! precipitation rPrecip and the snow melt rSnowMelt</span>
<a name="l01646"></a>01646   <span class="comment">!!</span>
<a name="l01647"></a>01647   <span class="comment">! [ ARGUMENTS ]</span>
<a name="l01648"></a>01648   <span class="keywordtype">type (</span> T_GENERAL_GRID <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pGrd         <span class="comment">! pointer to model grid</span>
<a name="l01649"></a>01649   <span class="keywordtype">type (</span>T_MODEL_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">pointer</span> :: pConfig <span class="comment">! pointer to data structure that contains</span>
<a name="l01650"></a>01650                                                    <span class="comment">! model options, flags, and other settings</span>
<a name="l01651"></a>01651   <span class="comment">! [ LOCALS ]</span>
<a name="l01652"></a>01652   <span class="keywordtype">integer (kind=T_INT) </span>:: i,j,k
<a name="l01653"></a>01653   <span class="keywordtype">type (</span> T_CELL <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: cel            <span class="comment">! pointer to cell data structure</span>
<a name="l01654"></a>01654   <span class="keywordtype">type (</span> T_LANDUSE_LOOKUP <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pLU  <span class="comment">! pointer to landuse data structure</span>
<a name="l01655"></a>01655   <span class="keywordtype">logical ( kind=T_LOGICAL ) </span>:: lMatch
<a name="l01656"></a>01656 
<a name="l01657"></a>01657   <span class="comment">! [ LOCAL PARAMETERS ]</span>
<a name="l01658"></a>01658 
<a name="l01659"></a>01659   <span class="keyword">if</span>(pConfig%iConfigureSMCapacity==CONFIG_SM_CAPACITY_CALCULATE) <span class="keyword">then</span>
<a name="l01660"></a>01660     <span class="comment">! Update the soil-water capacity based on land-cover and soil type</span>
<a name="l01661"></a>01661     <span class="keyword">do</span> j=1,pGrd%iNY
<a name="l01662"></a>01662       <span class="keyword">do</span> i=1,pGrd%iNX
<a name="l01663"></a>01663         lMatch = lFALSE
<a name="l01664"></a>01664         cel =&gt; pGrd%Cells(j,i)
<a name="l01665"></a>01665         <span class="comment">! loop over all LAND USE types...</span>
<a name="l01666"></a>01666         <span class="keyword">do</span> k=1,<span class="keyword">size</span>(pConfig%LU,1)
<a name="l01667"></a>01667           pLU =&gt; pConfig%LU(k)
<a name="l01668"></a>01668           <span class="keyword">if</span> ( pLU%iLandUseType == cel%iLandUse ) <span class="keyword">then</span>
<a name="l01669"></a>01669 <span class="comment">!            if( pLU%lCONSTANT_ROOT_ZONE_DEPTH ) then</span>
<a name="l01670"></a>01670 
<a name="l01671"></a>01671               cel%rSoilWaterCap = cel%rSoilWaterCapInput * &amp;
<a name="l01672"></a>01672                 pConfig%ROOTING_DEPTH(k,cel%iSoilGroup)
<a name="l01673"></a>01673 
<a name="l01674"></a>01674 <span class="comment">!            else</span>
<a name="l01675"></a>01675 <span class="comment">!              cel%rSoilWaterCap = cel%rSoilWaterCapInput * &amp;</span>
<a name="l01676"></a>01676 <span class="comment">!                interpolate(pLU%rX_ROOT_ZONE,pLU%rY_ROOT_ZONE,cel%rSoilWaterCapInput)</span>
<a name="l01677"></a>01677 <span class="comment">!            end if</span>
<a name="l01678"></a>01678 <span class="comment">!            if(cel%iLandUse == 82) then</span>
<a name="l01679"></a>01679 <span class="comment">!             write(UNIT=LU_LOG,FMT=*)  "LU:", cel%iLandUse,"  SOIL:",cel%iSoilGroup,"  out:", &amp;</span>
<a name="l01680"></a>01680 <span class="comment">!              "  in:",cel%rSoilWaterCapInput,"  product:",cel%rSoilWaterCap</span>
<a name="l01681"></a>01681 <span class="comment">!             write(UNIT=LU_LOG,FMT=*)  "   ",pLU%rX_ROOT_ZONE</span>
<a name="l01682"></a>01682 <span class="comment">!             write(UNIT=LU_LOG,FMT=*)  "   ",pLU%rY_ROOT_ZONE</span>
<a name="l01683"></a>01683 <span class="comment">!            endif</span>
<a name="l01684"></a>01684             lMatch=lTRUE
<a name="l01685"></a>01685             exit
<a name="l01686"></a>01686           <span class="keyword">end if</span>
<a name="l01687"></a>01687         <span class="keyword">end do</span>
<a name="l01688"></a>01688 <span class="comment">!      write(UNIT=LU_LOG,FMT=*)  j,i," table: ",pLU%iLandUseType," cell: ",cel%iLandUse</span>
<a name="l01689"></a>01689         <span class="keyword">if</span>(.not. lMATCH) <span class="keyword">then</span>
<a name="l01690"></a>01690           <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"i: "</span>,i,<span class="stringliteral">"  j: "</span>,j,<span class="stringliteral">"  cell LU: "</span>, cel%iLandUse
<a name="l01691"></a>01691           call Assert(lFALSE,&amp;
<a name="l01692"></a>01692           <span class="stringliteral">"Failed to match landuse grid with landuse table during soil moisture initialization"</span>)
<a name="l01693"></a>01693         <span class="keyword">endif</span>
<a name="l01694"></a>01694       <span class="keyword">end do</span>
<a name="l01695"></a>01695     <span class="keyword">end do</span>
<a name="l01696"></a>01696   <span class="keyword">end if</span>
<a name="l01697"></a>01697 
<a name="l01698"></a>01698   return
<a name="l01699"></a>01699 <span class="keyword">end</span> <span class="keyword">subroutine </span>gavg_InitializeSM
<a name="l01700"></a>01700 
<a name="l01701"></a>01701 <span class="comment">!----------------------------------------------------------------------</span>
<a name="l01702"></a>01702 
<a name="l01703"></a><a class="code" href="namespacegavg.html#be467ecdcb166a376caf0e0b03529ffc">01703</a> <span class="keyword">subroutine </span>gavg_ReadBasinMaskTable ( pConfig )
<a name="l01704"></a>01704   <span class="comment">!! reads the basin cacthment data file for subsequent processing</span>
<a name="l01705"></a>01705   <span class="keywordtype">type (</span>T_MODEL_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">pointer</span> :: pConfig <span class="comment">! pointer to data structure that contains</span>
<a name="l01706"></a>01706                                                    <span class="comment">! model options, flags, and other settings</span>
<a name="l01707"></a>01707   <span class="comment">! [ LOCALS ]</span>
<a name="l01708"></a>01708   <span class="keywordtype">integer (kind=T_INT) </span>:: iStat, iNumMaskFiles, i, iRecNum, iSize
<a name="l01709"></a>01709   <span class="keywordtype">character (len=256) </span>:: sRecord                  <span class="comment">! Input file text buffer</span>
<a name="l01710"></a>01710   <span class="keywordtype">character (len=256) </span>:: sItem                    <span class="comment">! Key word read from sRecord</span>
<a name="l01711"></a>01711 
<a name="l01712"></a>01712   <span class="comment">! open basin mask file</span>
<a name="l01713"></a>01713   <span class="keyword">open</span> ( unit=LU_MASK, file=pConfig%sBasinMaskFilename, &amp;
<a name="l01714"></a>01714             status=<span class="stringliteral">"OLD"</span>, iostat=iStat )
<a name="l01715"></a>01715   call Assert( <span class="keywordtype">LOGICAL( LOGICAL( iStat == 0,kind=T_LOGICAL)</span>,kind=T_LOGICAL), 
<a name="l01716"></a>01716             <span class="stringliteral">"Open failed for file: "</span> // pConfig%sBasinMaskFilename )
<a name="l01717"></a>01717 
<a name="l01718"></a>01718   <span class="comment">! read first line of file</span>
<a name="l01719"></a>01719   <span class="keyword">read</span> ( unit=LU_MASK, fmt=<span class="stringliteral">"(a256)"</span>, iostat=iStat ) sRecord
<a name="l01720"></a>01720   call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01721"></a>01721      <span class="stringliteral">"Error reading first line of basin mask table"</span> )
<a name="l01722"></a>01722 
<a name="l01723"></a>01723   <span class="comment">! read mask file to obtain expected number of basin mask files</span>
<a name="l01724"></a>01724   call Chomp_tab( sRecord, sItem )
<a name="l01725"></a>01725   call Uppercase( sItem )
<a name="l01726"></a>01726   <span class="keyword">if</span> ( sItem == <span class="stringliteral">"NUM_BASIN_MASK_FILES"</span> ) <span class="keyword">then</span>
<a name="l01727"></a>01727     call Chomp_tab ( sRecord, sItem )
<a name="l01728"></a>01728     <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) iNumMaskFiles
<a name="l01729"></a>01729     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Failed to read number of basin mask files"</span> )
<a name="l01730"></a>01730     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"==&gt; allocating memory for"</span>,iNumMaskFiles, &amp;
<a name="l01731"></a>01731        <span class="stringliteral">" landuse types within basin mask table"</span>
<a name="l01732"></a>01732   <span class="keyword">else</span>
<a name="l01733"></a>01733     call Assert( lFALSE, &amp;
<a name="l01734"></a>01734        <span class="stringliteral">"Unknown option in basin mask table; was expecting NUM_BASIN_MASK_FILES #"</span>)
<a name="l01735"></a>01735   <span class="keyword">end if</span>
<a name="l01736"></a>01736 
<a name="l01737"></a>01737   <span class="comment">! read (AND IGNORE) second line of file</span>
<a name="l01738"></a>01738   <span class="keyword">read</span> ( unit=LU_MASK, fmt=<span class="stringliteral">"(a256)"</span>, iostat=iStat ) sRecord
<a name="l01739"></a>01739   call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01740"></a>01740      <span class="stringliteral">"Error reading second line of basin mask table"</span> )
<a name="l01741"></a>01741 
<a name="l01742"></a>01742   <span class="comment">! now allocate memory for BASIN MASK table</span>
<a name="l01743"></a>01743   <span class="keyword">allocate</span> ( pConfig%BMASK( iNumMaskFiles ), stat=iStat )
<a name="l01744"></a>01744   call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01745"></a>01745     <span class="stringliteral">"Could not allocate space for basin mask data structure"</span> )
<a name="l01746"></a>01746 
<a name="l01747"></a>01747   iSize = <span class="keyword">size</span>(pConfig%BMASK,1)
<a name="l01748"></a>01748 
<a name="l01749"></a>01749   iRecNum = 1
<a name="l01750"></a>01750 
<a name="l01751"></a>01751   BMASK: <span class="keyword">do</span>
<a name="l01752"></a>01752 
<a name="l01753"></a>01753     <span class="keyword">read</span> ( unit=LU_MASK, fmt=<span class="stringliteral">"(a256)"</span>, iostat=iStat ) sRecord
<a name="l01754"></a>01754     <span class="keyword">if</span> ( iStat &lt; 0 ) exit     <span class="comment">! EOF mark</span>
<a name="l01755"></a>01755     <span class="keyword">if</span> ( sRecord(1:1) == <span class="stringliteral">"#"</span> ) cycle      <span class="comment">! Ignore comment lines</span>
<a name="l01756"></a>01756 
<a name="l01757"></a>01757     <span class="keyword">if</span>(iRecNum &gt; iSize) <span class="keyword">then</span>
<a name="l01758"></a>01758       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">""</span>
<a name="l01759"></a>01759       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">" *** The maximum number of basin mask table elements has"</span>
<a name="l01760"></a>01760       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"     been read in before reaching the end of the file."</span>
<a name="l01761"></a>01761       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">""</span>
<a name="l01762"></a>01762       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"     size of allocated memory for BASIN MASK table: "</span>,iSize
<a name="l01763"></a>01763       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"     current record number: "</span>, iRecNum
<a name="l01764"></a>01764       exit
<a name="l01765"></a>01765     <span class="keyword">end if</span>
<a name="l01766"></a>01766 
<a name="l01767"></a>01767     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">""</span>
<a name="l01768"></a>01768     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"-----------------------------------------------------------"</span>
<a name="l01769"></a>01769     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Reading basin mask record number "</span>,iRecNum, <span class="stringliteral">" of "</span>,iNumMaskFiles
<a name="l01770"></a>01770     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">""</span>
<a name="l01771"></a>01771 
<a name="l01772"></a>01772     call Chomp_tab ( sRecord, sItem )
<a name="l01773"></a>01773     <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) pConfig%BMASK(iRecNum)%sUSGS_UpstreamOrderID
<a name="l01774"></a>01774     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01775"></a>01775       <span class="stringliteral">"Error reading upstream order ID in basin mask table"</span> )
<a name="l01776"></a>01776     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Upstream order ID = "</span>,TRIM(pConfig%BMASK(iRecNum)%sUSGS_UpstreamOrderID)
<a name="l01777"></a>01777 
<a name="l01778"></a>01778     call Chomp_tab ( sRecord, sItem )
<a name="l01779"></a>01779     pConfig%BMASK(iRecNum)%sBasinDescription = TRIM(sItem)
<a name="l01780"></a>01780     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01781"></a>01781       <span class="stringliteral">"Error reading basin description in basin mask table"</span> )
<a name="l01782"></a>01782     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Basin description = "</span>,TRIM(pConfig%BMASK(iRecNum)%sBasinDescription)
<a name="l01783"></a>01783 
<a name="l01784"></a>01784     call Chomp_tab ( sRecord, sItem )
<a name="l01785"></a>01785 <span class="comment">!    read ( unit=sItem, fmt=*, iostat=iStat ) pConfig%BMASK(iRecNum)%sBasinMaskFilename</span>
<a name="l01786"></a>01786     pConfig%BMASK(iRecNum)%sBasinMaskFilename = TRIM(ADJUSTL(sItem))
<a name="l01787"></a>01787     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01788"></a>01788       <span class="stringliteral">"Error reading basin mask filename in basin mask table"</span> )
<a name="l01789"></a>01789     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Basin mask filename = "</span>,TRIM(pConfig%BMASK(iRecNum)%sBasinMaskFilename)
<a name="l01790"></a>01790 
<a name="l01791"></a>01791     call Chomp_tab ( sRecord, sItem )
<a name="l01792"></a>01792     <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) pConfig%BMASK(iRecNum)%sFileType
<a name="l01793"></a>01793     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01794"></a>01794       <span class="stringliteral">"Error reading basin mask file type in basin mask table"</span> )
<a name="l01795"></a>01795     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Basin mask filetype = "</span>,TRIM(pConfig%BMASK(iRecNum)%sFileType)
<a name="l01796"></a>01796 
<a name="l01797"></a>01797     call Chomp_tab ( sRecord, sItem )
<a name="l01798"></a>01798     <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) pConfig%BMASK(iRecNum)%rQb
<a name="l01799"></a>01799     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01800"></a>01800       <span class="stringliteral">"Error reading baseflow estimate Qb in basin mask table"</span> )
<a name="l01801"></a>01801     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Qb = "</span>,pConfig%BMASK(iRecNum)%rQb
<a name="l01802"></a>01802 
<a name="l01803"></a>01803     call Chomp_tab ( sRecord, sItem )
<a name="l01804"></a>01804     <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) pConfig%BMASK(iRecNum)%rDrainageArea
<a name="l01805"></a>01805     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01806"></a>01806       <span class="stringliteral">"Error reading basin drainage area in basin mask table"</span> )
<a name="l01807"></a>01807     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Drainage area = "</span>, &amp;
<a name="l01808"></a>01808         pConfig%BMASK(iRecNum)%rDrainageArea
<a name="l01809"></a>01809 
<a name="l01810"></a>01810     iRecNum = iRecNum + 1
<a name="l01811"></a>01811 
<a name="l01812"></a>01812   <span class="keyword">end do</span> BMASK
<a name="l01813"></a>01813 
<a name="l01814"></a>01814   flush(UNIT=LU_LOG)
<a name="l01815"></a>01815 
<a name="l01816"></a>01816 <span class="keyword">end</span> <span class="keyword">subroutine </span>gavg_ReadBasinMaskTable
<a name="l01817"></a>01817 
<a name="l01818"></a>01818 <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l01819"></a>01819 
<a name="l01820"></a><a class="code" href="namespacegavg.html#e07f7a0a57e0cd40b00b4b41ad4d5a23">01820</a> <span class="keyword">subroutine </span>gavg_ReadLanduseLookupTable( pConfig )
<a name="l01821"></a>01821   <span class="comment">!! Reads the landuse data from pConfig%sLanduseLookupFilename</span>
<a name="l01822"></a>01822   <span class="comment">! [ ARGUMENTS ]</span>
<a name="l01823"></a>01823   <span class="keywordtype">type (</span>T_MODEL_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">pointer</span> :: pConfig <span class="comment">! pointer to data structure that contains</span>
<a name="l01824"></a>01824                                                    <span class="comment">! model options, flags, and other settings</span>
<a name="l01825"></a>01825   <span class="comment">! [ LOCALS ]</span>
<a name="l01826"></a>01826   <span class="keywordtype">integer (kind=T_INT) </span>:: iStat, iNumLandUses, i, iType, iRecNum, iSize
<a name="l01827"></a>01827   <span class="keywordtype">integer (kind=T_INT) </span>:: iNumSoilTypes
<a name="l01828"></a>01828   <span class="keywordtype">character (len=1024) </span>:: sRecord                  <span class="comment">! Input file text buffer</span>
<a name="l01829"></a>01829   <span class="keywordtype">character (len=256) </span>:: sItem                    <span class="comment">! Key word read from sRecord</span>
<a name="l01830"></a>01830 
<a name="l01831"></a>01831   <span class="comment">! open landuse file</span>
<a name="l01832"></a>01832   <span class="keyword">open</span> ( unit=LU_LOOKUP, file=pConfig%sLanduseLookupFilename, &amp;
<a name="l01833"></a>01833             status=<span class="stringliteral">"OLD"</span>, iostat=iStat )
<a name="l01834"></a>01834   call Assert( <span class="keywordtype">LOGICAL( LOGICAL( iStat == 0,kind=T_LOGICAL)</span>,kind=T_LOGICAL), 
<a name="l01835"></a>01835             <span class="stringliteral">"Open failed for file: "</span> // pConfig%sLanduseLookupFilename )
<a name="l01836"></a>01836 
<a name="l01837"></a>01837   <span class="comment">! read first line of file</span>
<a name="l01838"></a>01838   <span class="keyword">read</span> ( unit=LU_LOOKUP, fmt=<span class="stringliteral">"(a)"</span>, iostat=iStat ) sRecord
<a name="l01839"></a>01839   call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01840"></a>01840      <span class="stringliteral">"Error reading first line of landuse lookup table"</span> )
<a name="l01841"></a>01841 
<a name="l01842"></a>01842   <span class="comment">! read landuse file to obtain expected number of landuse types</span>
<a name="l01843"></a>01843   call Chomp_tab( sRecord, sItem )
<a name="l01844"></a>01844   call Uppercase( sItem )
<a name="l01845"></a>01845   <span class="keyword">if</span> ( sItem == <span class="stringliteral">"NUM_LANDUSE_TYPES"</span> ) <span class="keyword">then</span>
<a name="l01846"></a>01846     call Chomp_tab ( sRecord, sItem )
<a name="l01847"></a>01847     <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) iNumLandUses
<a name="l01848"></a>01848     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Failed to read number of landuse types"</span> )
<a name="l01849"></a>01849     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"==&gt; allocating memory for"</span>,iNumLandUses,<span class="stringliteral">"landuse types within lookup table"</span>
<a name="l01850"></a>01850   <span class="keyword">else</span>
<a name="l01851"></a>01851     call Assert( lFALSE, &amp;
<a name="l01852"></a>01852        <span class="stringliteral">"Unknown option in landuse lookup table; was expecting NUM_LANDUSE_TYPES #"</span>)
<a name="l01853"></a>01853   <span class="keyword">end if</span>
<a name="l01854"></a>01854 
<a name="l01855"></a>01855   <span class="comment">! read second line of file</span>
<a name="l01856"></a>01856   <span class="keyword">read</span> ( unit=LU_LOOKUP, fmt=<span class="stringliteral">"(a)"</span>, iostat=iStat ) sRecord
<a name="l01857"></a>01857   call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01858"></a>01858      <span class="stringliteral">"Error reading second line of landuse lookup table"</span> )
<a name="l01859"></a>01859 
<a name="l01860"></a>01860   <span class="comment">! read landuse file to obtain expected number of soil types</span>
<a name="l01861"></a>01861   call Chomp_tab( sRecord, sItem )
<a name="l01862"></a>01862   call Uppercase( sItem )
<a name="l01863"></a>01863   <span class="keyword">if</span> ( sItem == <span class="stringliteral">"NUM_SOIL_TYPES"</span> ) <span class="keyword">then</span>
<a name="l01864"></a>01864     call Chomp_tab ( sRecord, sItem )
<a name="l01865"></a>01865     <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) iNumSoilTypes
<a name="l01866"></a>01866     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Failed to read number of soil types"</span> )
<a name="l01867"></a>01867     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"==&gt; allocating memory for"</span>,iNumSoilTypes,<span class="stringliteral">"soil types within lookup table"</span>
<a name="l01868"></a>01868   <span class="keyword">else</span>
<a name="l01869"></a>01869     call Assert( lFALSE, &amp;
<a name="l01870"></a>01870        <span class="stringliteral">"Unknown option in landuse lookup table; was expecting NUM_SOIL_TYPES #"</span>)
<a name="l01871"></a>01871   <span class="keyword">end if</span>
<a name="l01872"></a>01872 
<a name="l01873"></a>01873   <span class="comment">! now allocate memory for landuse table</span>
<a name="l01874"></a>01874   <span class="keyword">allocate</span> ( pConfig%LU( iNumLandUses ), stat=iStat )
<a name="l01875"></a>01875   call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01876"></a>01876     <span class="stringliteral">"Could not allocate space for landuse data structure"</span> )
<a name="l01877"></a>01877 
<a name="l01878"></a>01878   iSize = <span class="keyword">size</span>(pConfig%LU,1)
<a name="l01879"></a>01879 
<a name="l01880"></a>01880   <span class="comment">! now allocate memory for SOILS subtable within landuse table</span>
<a name="l01881"></a>01881   <span class="keyword">allocate</span> ( pConfig%CN( iNumLandUses,iNumSoilTypes ), stat=iStat )
<a name="l01882"></a>01882   call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01883"></a>01883     <span class="stringliteral">"Could not allocate space for CN subtable within landuse data structure"</span> )
<a name="l01884"></a>01884 
<a name="l01885"></a>01885   <span class="comment">! now allocate memory for ROOTING DEPTH subtable within landuse table</span>
<a name="l01886"></a>01886   <span class="keyword">allocate</span> ( pConfig%ROOTING_DEPTH( iNumLandUses,iNumSoilTypes ), stat=iStat )
<a name="l01887"></a>01887   call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01888"></a>01888     <span class="stringliteral">"Could not allocate space for ROOTING_DEPTH subtable within landuse data structure"</span> )
<a name="l01889"></a>01889 
<a name="l01890"></a>01890   <span class="comment">! now allocate memory for MAX_RECHARGE subtable within landuse table</span>
<a name="l01891"></a>01891   <span class="keyword">allocate</span> ( pConfig%MAX_RECHARGE( iNumLandUses,iNumSoilTypes ), stat=iStat )
<a name="l01892"></a>01892   call Assert ( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01893"></a>01893     <span class="stringliteral">"Could not allocate space for MAX_RECHARGE subtable within landuse data structure"</span> )
<a name="l01894"></a>01894 
<a name="l01895"></a>01895 
<a name="l01896"></a>01896   iRecNum = 1
<a name="l01897"></a>01897 
<a name="l01898"></a>01898   LU_READ: <span class="keyword">do</span>
<a name="l01899"></a>01899 
<a name="l01900"></a>01900     <span class="keyword">read</span> ( unit=LU_LOOKUP, fmt=<span class="stringliteral">"(a)"</span>, iostat=iStat ) sRecord
<a name="l01901"></a>01901     <span class="keyword">if</span> ( iStat &lt; 0 ) exit     <span class="comment">! EOF mark</span>
<a name="l01902"></a>01902     <span class="keyword">if</span> ( sRecord(1:1) == <span class="stringliteral">"#"</span> ) cycle      <span class="comment">! Ignore comment lines</span>
<a name="l01903"></a>01903 
<a name="l01904"></a>01904     <span class="keyword">if</span>(iRecNum &gt; iSize) <span class="keyword">then</span>
<a name="l01905"></a>01905       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">""</span>
<a name="l01906"></a>01906       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">" *** The maximum number of landuse lookup table elements has"</span>
<a name="l01907"></a>01907       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"     been read in before reaching the end of the file."</span>
<a name="l01908"></a>01908       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">""</span>
<a name="l01909"></a>01909       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"     size of allocated memory for LU table: "</span>,iSize
<a name="l01910"></a>01910       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"     current record number: "</span>, iRecNum
<a name="l01911"></a>01911       exit
<a name="l01912"></a>01912     <span class="keyword">end if</span>
<a name="l01913"></a>01913 
<a name="l01914"></a>01914     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">""</span>
<a name="l01915"></a>01915     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"-----------------------------------------------------------"</span>
<a name="l01916"></a>01916     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"Reading landuse record number "</span>,iRecNum, <span class="stringliteral">" of "</span>,iNumLandUses
<a name="l01917"></a>01917     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*) <span class="stringliteral">""</span>
<a name="l01918"></a>01918 
<a name="l01919"></a>01919     call Chomp_tab ( sRecord, sItem )
<a name="l01920"></a>01920     <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) pConfig%LU(iRecNum)%iLandUseType
<a name="l01921"></a>01921     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Error reading land use type in landuse lookup table"</span> )
<a name="l01922"></a>01922     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  landuse type = "</span>,pConfig%LU(iRecNum)%iLandUseType
<a name="l01923"></a>01923 
<a name="l01924"></a>01924     call Chomp_tab ( sRecord, pConfig%LU(iRecNum)%sLandUseDescription )
<a name="l01925"></a>01925     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  landuse description = "</span>, &amp;
<a name="l01926"></a>01926       TRIM(pConfig%LU(iRecNum)%sLandUseDescription)
<a name="l01927"></a>01927 
<a name="l01928"></a>01928     call Chomp_tab ( sRecord, pConfig%LU(iRecNum)%sAssumedPercentImperviousness )
<a name="l01929"></a>01929     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  assumed % imperviousness = "</span>, &amp;
<a name="l01930"></a>01930       TRIM(pConfig%LU(iRecNum)%sAssumedPercentImperviousness)
<a name="l01931"></a>01931 
<a name="l01932"></a>01932     <span class="keyword">do</span> i=1,iNumSoilTypes
<a name="l01933"></a>01933       call Chomp_tab ( sRecord, sItem )
<a name="l01934"></a>01934       <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) pConfig%CN(iRecNum,i)
<a name="l01935"></a>01935       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01936"></a>01936         <span class="stringliteral">"Error reading curve number for soil group in landuse lookup table"</span> )
<a name="l01937"></a>01937       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  curve number for soil group"</span>,i,<span class="stringliteral">": "</span>,pConfig%CN(iRecNum,i)
<a name="l01938"></a>01938     <span class="keyword">end do</span>
<a name="l01939"></a>01939 
<a name="l01940"></a>01940     <span class="keyword">do</span> i=1,iNumSoilTypes
<a name="l01941"></a>01941       call Chomp_tab ( sRecord, sItem )
<a name="l01942"></a>01942       <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) pConfig%MAX_RECHARGE(iRecNum,i)
<a name="l01943"></a>01943       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01944"></a>01944         <span class="stringliteral">"Error reading maximum recharge for soil group in landuse lookup table"</span> )
<a name="l01945"></a>01945       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  MAXIMUM RECHARGE for soil group"</span>,i,<span class="stringliteral">": "</span>,pConfig%MAX_RECHARGE(iRecNum,i)
<a name="l01946"></a>01946     <span class="keyword">end do</span>
<a name="l01947"></a>01947 
<a name="l01948"></a>01948     call Chomp_tab ( sRecord, sItem )
<a name="l01949"></a>01949     <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) pConfig%LU(iRecNum)%rIntercept_GrowingSeason
<a name="l01950"></a>01950     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Error reading interception values in landuse file"</span> )
<a name="l01951"></a>01951     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  Interception value for growing season = "</span>,pConfig%LU(iRecNum)%rIntercept_GrowingSeason
<a name="l01952"></a>01952 
<a name="l01953"></a>01953     call Chomp_tab ( sRecord, sItem )
<a name="l01954"></a>01954    <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) pConfig%LU(iRecNum)%rIntercept_NonGrowingSeason
<a name="l01955"></a>01955     call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, <span class="stringliteral">"Error reading interception values in landuse file"</span> )
<a name="l01956"></a>01956     <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  Interception value for non-growing season = "</span>, &amp;
<a name="l01957"></a>01957         pConfig%LU(iRecNum)%rIntercept_NonGrowingSeason
<a name="l01958"></a>01958 
<a name="l01959"></a>01959     <span class="comment">! now read in a rooting depth for each landuse/soil type combination</span>
<a name="l01960"></a>01960     <span class="keyword">do</span> i=1,iNumSoilTypes
<a name="l01961"></a>01961       call Chomp_tab ( sRecord, sItem )
<a name="l01962"></a>01962       <span class="keyword">read</span> ( unit=sItem, fmt=*, iostat=iStat ) pConfig%ROOTING_DEPTH(iRecNum,i)
<a name="l01963"></a>01963       call Assert( <span class="keywordtype">LOGICAL( iStat == 0,kind=T_LOGICAL)</span>, 
<a name="l01964"></a>01964         <span class="stringliteral">"Error reading rooting depth for soil group in landuse lookup table"</span> )
<a name="l01965"></a>01965       <span class="keyword">write</span>(UNIT=LU_LOG,FMT=*)  <span class="stringliteral">"  ROOTING DEPTH for soil group"</span>,i,<span class="stringliteral">": "</span>,pConfig%ROOTING_DEPTH(iRecNum,i)
<a name="l01966"></a>01966     <span class="keyword">end do</span>
<a name="l01967"></a>01967 
<a name="l01968"></a>01968 <span class="comment">!    call Chomp_tab ( sRecord, sItem )</span>
<a name="l01969"></a>01969 <span class="comment">!    read ( unit=sItem, fmt=*, iostat=iStat ) pConfig%LU(iRecNum)%lCONSTANT_ROOT_ZONE_DEPTH</span>
<a name="l01970"></a>01970 <span class="comment">!    call Assert( LOGICAL( iStat == 0,kind=T_LOGICAL), "Error reading root-zone depth constant in landuse file" )</span>
<a name="l01971"></a>01971 <span class="comment">!    write(UNIT=LU_LOG,FMT=*)  "  Root zone treated as a constant value?  ", &amp;</span>
<a name="l01972"></a>01972 <span class="comment">!        pConfig%LU(iRecNum)%lCONSTANT_ROOT_ZONE_DEPTH</span>
<a name="l01973"></a>01973 
<a name="l01974"></a>01974 <span class="comment">!    do i=1,iNUM_ROOT_ZONE_PAIRS</span>
<a name="l01975"></a>01975 <span class="comment">!</span>
<a name="l01976"></a>01976 <span class="comment">!      call Chomp_tab ( sRecord, sItem )</span>
<a name="l01977"></a>01977 <span class="comment">!      read ( unit=sItem, fmt=*, iostat=iStat ) pConfig%LU(iRecNum)%rX_ROOT_ZONE(i)</span>
<a name="l01978"></a>01978 <span class="comment">!      call Assert( LOGICAL( iStat == 0,kind=T_LOGICAL), &amp;</span>
<a name="l01979"></a>01979 <span class="comment">!       "Error reading root zone X value number in landuse file" )</span>
<a name="l01980"></a>01980 <span class="comment">!      write(UNIT=LU_LOG,FMT=*)  "    Root zone available water capacity (in/ft): X(",i,") = ", &amp;</span>
<a name="l01981"></a>01981 <span class="comment">!          pConfig%LU(iRecNum)%rX_ROOT_ZONE(i)</span>
<a name="l01982"></a>01982 <span class="comment">!</span>
<a name="l01983"></a>01983 <span class="comment">!    end do</span>
<a name="l01984"></a>01984 <span class="comment">!</span>
<a name="l01985"></a>01985 <span class="comment">!    do i=1,iNUM_ROOT_ZONE_PAIRS</span>
<a name="l01986"></a>01986 <span class="comment">!</span>
<a name="l01987"></a>01987 <span class="comment">!      call Chomp_tab ( sRecord, sItem )</span>
<a name="l01988"></a>01988 <span class="comment">!      read ( unit=sItem, fmt=*, iostat=iStat ) pConfig%LU(iRecNum)%rY_ROOT_ZONE(i)</span>
<a name="l01989"></a>01989 <span class="comment">!      call Assert( LOGICAL( iStat == 0,kind=T_LOGICAL), "Error reading root zone Y values in landuse file" )</span>
<a name="l01990"></a>01990 <span class="comment">!      write(UNIT=LU_LOG,FMT=*)  "    Root zone root zone depth (ft):             Y(",i,") = ", &amp;</span>
<a name="l01991"></a>01991 <span class="comment">!          pConfig%LU(iRecNum)%rY_ROOT_ZONE(i)</span>
<a name="l01992"></a>01992 <span class="comment">!</span>
<a name="l01993"></a>01993 <span class="comment">!    end do</span>
<a name="l01994"></a>01994 
<a name="l01995"></a>01995     iRecNum = iRecNum + 1
<a name="l01996"></a>01996 
<a name="l01997"></a>01997   <span class="keyword">end do</span> LU_READ
<a name="l01998"></a>01998 
<a name="l01999"></a>01999   <span class="comment">! That's all!</span>
<a name="l02000"></a>02000   <span class="keyword">close</span> ( unit=LU_LOOKUP )
<a name="l02001"></a>02001 
<a name="l02002"></a>02002   return
<a name="l02003"></a>02003 <span class="keyword">end</span> <span class="keyword">subroutine </span>gavg_ReadLanduseLookupTable
<a name="l02004"></a>02004 
<a name="l02005"></a>02005 <span class="comment">!--------------------------------------------------------------------------</span>
<a name="l02006"></a>02006 
<a name="l02007"></a><a class="code" href="namespacegavg.html#13e9fbb1a5ff1cfbc1fc50be59cb19bb">02007</a> <span class="keyword">subroutine </span>gavg_WriteGrids(pGrd, pConfig, sMonthName, iDay,iMonth, &amp;
<a name="l02008"></a>02008     iYear, iDayOfYear)
<a name="l02009"></a>02009   <span class="comment">!! Writes the monthly output arrays in the proper grid format</span>
<a name="l02010"></a>02010   <span class="comment">! [ ARGUMENTS ]</span>
<a name="l02011"></a>02011   <span class="keywordtype">type (</span> T_GENERAL_GRID <span class="keywordtype">)</span>,<span class="keywordtype">pointer</span> :: pGrd        <span class="comment">! pointer to model grid</span>
<a name="l02012"></a>02012   <span class="keywordtype">type (</span>T_MODEL_CONFIGURATION<span class="keywordtype">)</span>, <span class="keywordtype">pointer</span> :: pConfig <span class="comment">! pointer to data structure that contains</span>
<a name="l02013"></a>02013                                                    <span class="comment">! model options, flags, and other settings</span>
<a name="l02014"></a>02014   <span class="keywordtype">character (len=*)</span>,<span class="keywordtype">intent(in)</span> :: sMonthName
<a name="l02015"></a>02015   <span class="keywordtype">integer (kind=T_INT)</span>, <span class="keywordtype">intent(in)</span> :: iDayOfYear, iMonth, iDay, iYear
<a name="l02016"></a>02016 
<a name="l02017"></a>02017   <span class="comment">! [ LOCALS ]</span>
<a name="l02018"></a>02018   <span class="keywordtype">real (kind=T_DBL) </span>:: xmin,xmax,ymin,ymax
<a name="l02019"></a>02019   <span class="keywordtype">character (len=256)</span> sBufOut,sBufFuture,sBufSuffix,sDayText,sMonthText, 
<a name="l02020"></a>02020                          sYearText
<a name="l02021"></a>02021 
<a name="l02022"></a>02022   sBufOut = <span class="stringliteral">"output"</span> // pConfig%sSlash //trim(sMonthName)
<a name="l02023"></a>02023   sBufFuture = <span class="stringliteral">"output"</span> // pConfig%sSlash // <span class="stringliteral">"future"</span> // pConfig%sSlash
<a name="l02024"></a>02024   sBufSuffix = trim(pConfig%sOutputFileSuffix)
<a name="l02025"></a>02025 
<a name="l02026"></a>02026   <span class="keyword">write</span>(sDayText,fmt=<span class="stringliteral">"(a1,i2.2,a1,i2.2,a1,i4)"</span>) <span class="stringliteral">"_"</span>,iMonth,<span class="stringliteral">"_"</span>,iDay,<span class="stringliteral">"_"</span>,iYear
<a name="l02027"></a>02027   <span class="keyword">write</span>(sMonthText,fmt=<span class="stringliteral">"(a1,i2.2,a1,i4)"</span>) <span class="stringliteral">"_"</span>,iMonth,<span class="stringliteral">"_"</span>,iYear
<a name="l02028"></a>02028   <span class="keyword">write</span>(sYearText,fmt=<span class="stringliteral">"(a1,i4)"</span>) <span class="stringliteral">"_"</span>,iYear
<a name="l02029"></a>02029 
<a name="l02030"></a>02030   xmin = pGrd%rX0
<a name="l02031"></a>02031   xmax = pGrd%rX1
<a name="l02032"></a>02032   ymin = pGrd%rY0
<a name="l02033"></a>02033   ymax = pGrd%rY1
<a name="l02034"></a>02034 
<a name="l02035"></a>02035   <span class="keyword">if</span> ( pConfig%iOutputFormat == OUTPUT_ARC ) <span class="keyword">then</span>
<a name="l02036"></a>02036     <span class="keyword">if</span> ( trim(sMonthName) == <span class="stringliteral">"ANNUAL"</span> ) <span class="keyword">then</span>
<a name="l02037"></a>02037 <span class="comment">!      call grid_WriteArcGrid( trim(sBufOut) // "_rch." // trim(sBufSuffix), &amp;</span>
<a name="l02038"></a>02038 <span class="comment">!               xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rAnnualRecharge )</span>
<a name="l02039"></a>02039 <span class="comment">!      call grid_WriteArcGrid(trim(sBufOut) // "_pot_et." // trim(sBufSuffix), &amp;</span>
<a name="l02040"></a>02040 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rAnnualPotET )</span>
<a name="l02041"></a>02041 <span class="comment">!      call grid_WriteArcGrid(trim(sBufOut) // "_act_et." // trim(sBufSuffix), &amp;</span>
<a name="l02042"></a>02042 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rAnnualActET )</span>
<a name="l02043"></a>02043       call <a class="code" href="namespaceswb__grid.html#9d60759cd038c3d1936d912299e2f4a2">grid_WriteArcGrid</a>(trim(sBufFuture) // <span class="stringliteral">"final_pct_sm"</span> // &amp;
<a name="l02044"></a>02044         trim(sYearText) // <span class="stringliteral">"."</span> //trim(sBufSuffix), &amp;
<a name="l02045"></a>02045           xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSoilMoisturePct )
<a name="l02046"></a>02046       call <a class="code" href="namespaceswb__grid.html#9d60759cd038c3d1936d912299e2f4a2">grid_WriteArcGrid</a>(trim(sBufFuture) // <span class="stringliteral">"final_snow_cover"</span> // &amp;
<a name="l02047"></a>02047         trim(sYearText) // <span class="stringliteral">"."</span> //trim(sBufSuffix), &amp;
<a name="l02048"></a>02048           xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSnowCover )
<a name="l02049"></a>02049       call <a class="code" href="namespaceswb__grid.html#9d60759cd038c3d1936d912299e2f4a2">grid_WriteArcGrid</a>(trim(sBufOut) // <span class="stringliteral">"_soil_water_cap"</span> // &amp;
<a name="l02050"></a>02050         trim(sYearText) // <span class="stringliteral">"."</span> //trim(sBufSuffix), &amp;
<a name="l02051"></a>02051           xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSoilWaterCap )
<a name="l02052"></a>02052     <span class="keyword">else</span> <span class="keyword">if</span> ( sMonthName(1:3) == <span class="stringliteral">'day'</span> ) <span class="keyword">then</span>
<a name="l02053"></a>02053 <span class="comment">!      call grid_WriteArcGrid("precip." // sMonthName(4:6), &amp;</span>
<a name="l02054"></a>02054 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rGrossPrecip )</span>
<a name="l02055"></a>02055 <span class="comment">!      call grid_WriteArcGrid("output\\daily\\recharge" // trim(sDayText) // &amp;</span>
<a name="l02056"></a>02056 <span class="comment">!          "." // sBufSuffix, &amp;</span>
<a name="l02057"></a>02057 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rDailyRecharge )</span>
<a name="l02058"></a>02058 
<a name="l02059"></a>02059 <span class="comment">!        call grid_WriteArcGrid("output\\daily\\pot_et" // trim(sDayText) // &amp;</span>
<a name="l02060"></a>02060 <span class="comment">!          "." // sBufSuffix, &amp;</span>
<a name="l02061"></a>02061 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSM_PotentialET )</span>
<a name="l02062"></a>02062 <span class="comment">!        call grid_WriteArcGrid("output\\act_et." // sMonthName(4:6), &amp;</span>
<a name="l02063"></a>02063 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSM_ActualET )</span>
<a name="l02064"></a>02064 <span class="comment">!        call grid_WriteArcGrid("output\\net_infil." // sMonthName(4:6), &amp;</span>
<a name="l02065"></a>02065 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rNetInfil )</span>
<a name="l02066"></a>02066 <span class="comment">!        call grid_WriteArcGrid("output\\daily\\inflow" // trim(sDayText) // &amp;</span>
<a name="l02067"></a>02067 <span class="comment">!          "." // sBufSuffix, &amp;</span>
<a name="l02068"></a>02068 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rInFlow )</span>
<a name="l02069"></a>02069 <span class="comment">!        call grid_WriteArcGrid("output\\daily\\outflow" // trim(sDayText) // &amp;</span>
<a name="l02070"></a>02070 <span class="comment">!          "." // sBufSuffix, &amp;</span>
<a name="l02071"></a>02071 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rOutFlow )</span>
<a name="l02072"></a>02072 <span class="comment">!        call grid_WriteArcGrid("output\\daily\\soil_mois" // trim(sDayText) // &amp;</span>
<a name="l02073"></a>02073 <span class="comment">!          "." // sBufSuffix, &amp;</span>
<a name="l02074"></a>02074 <span class="comment">!            xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSoilMoisture )</span>
<a name="l02075"></a>02075 <span class="comment">!        call grid_WriteArcGrid("output\\daily\\curve_num" // trim(sDayText) // &amp;</span>
<a name="l02076"></a>02076 <span class="comment">!          "." // sBufSuffix, &amp;</span>
<a name="l02077"></a>02077 <span class="comment">!            xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rAdjCN )</span>
<a name="l02078"></a>02078 <span class="comment">!        call grid_WriteArcGrid("output\\daily\\snow_cov" // trim(sDayText) // &amp;</span>
<a name="l02079"></a>02079 <span class="comment">!          "." // sBufSuffix, &amp;</span>
<a name="l02080"></a>02080 <span class="comment">!            xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSnowCover )</span>
<a name="l02081"></a>02081 
<a name="l02082"></a>02082     <span class="keyword">else</span>
<a name="l02083"></a>02083 
<a name="l02084"></a>02084 <span class="comment">!      call grid_WriteArcGrid(trim(sBufOut) // "_rch"// trim(sMonthText) // &amp;</span>
<a name="l02085"></a>02085 <span class="comment">!          "." // sBufSuffix, &amp;</span>
<a name="l02086"></a>02086 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rMonthlyRecharge )</span>
<a name="l02087"></a>02087 <span class="comment">!      call grid_WriteArcGrid(trim(sBufOut) // "_pot_et." // trim(sBufSuffix), &amp;</span>
<a name="l02088"></a>02088 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rMonthlyPotET )</span>
<a name="l02089"></a>02089 <span class="comment">!      call grid_WriteArcGrid(trim(sBufOut) // "_act_et." // trim(sBufSuffix), &amp;</span>
<a name="l02090"></a>02090 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rMonthlyActET )</span>
<a name="l02091"></a>02091 <span class="comment">!      call grid_WriteArcGrid(trim(sBufOut) // "_inflow." // trim(sBufSuffix), &amp;</span>
<a name="l02092"></a>02092 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rMonthlyInFlow )</span>
<a name="l02093"></a>02093 <span class="comment">!      call grid_WriteArcGrid(trim(sBufOut) // "_outflow." // trim(sBufSuffix), &amp;</span>
<a name="l02094"></a>02094 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rMonthlyOutFlow )</span>
<a name="l02095"></a>02095 <span class="comment">!        call grid_WriteArcGrid(trim(sBufOut) // "_sm." // trim(sBufSuffix), &amp;</span>
<a name="l02096"></a>02096 <span class="comment">!            xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSoilMoisture )</span>
<a name="l02097"></a>02097     <span class="keyword">end if</span>
<a name="l02098"></a>02098   <span class="keyword">else</span> <span class="keyword">if</span> ( pConfig%iOutputFormat == OUTPUT_SURFER ) <span class="keyword">then</span>
<a name="l02099"></a>02099     <span class="keyword">if</span> ( trim(sMonthName) == <span class="stringliteral">"ANNUAL"</span> ) <span class="keyword">then</span>
<a name="l02100"></a>02100 <span class="comment">!      call grid_WriteSurferGrid(trim(sBufOut) // "_rch." // trim(sBufSuffix), &amp;</span>
<a name="l02101"></a>02101 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rAnnualRecharge )</span>
<a name="l02102"></a>02102 <span class="comment">!      call grid_WriteSurferGrid(trim(sBufOut) // "_pot_et." // trim(sBufSuffix), &amp;</span>
<a name="l02103"></a>02103 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rAnnualPotET )</span>
<a name="l02104"></a>02104 <span class="comment">!      call grid_WriteSurferGrid(trim(sBufOut) // "_act_et." // trim(sBufSuffix), &amp;</span>
<a name="l02105"></a>02105 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rAnnualActET )</span>
<a name="l02106"></a>02106       call <a class="code" href="namespaceswb__grid.html#af1f4ad8065d88804760ea3d28fb2e02">grid_WriteSurferGrid</a>(trim(sBufFuture) // <span class="stringliteral">"final_pct_sm"</span> // &amp;
<a name="l02107"></a>02107         trim(sYearText) // <span class="stringliteral">"."</span> //trim(sBufSuffix), &amp;
<a name="l02108"></a>02108           xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSoilMoisturePct )
<a name="l02109"></a>02109       call <a class="code" href="namespaceswb__grid.html#af1f4ad8065d88804760ea3d28fb2e02">grid_WriteSurferGrid</a>(trim(sBufFuture) // <span class="stringliteral">"final_snow_cover"</span> // &amp;
<a name="l02110"></a>02110         trim(sYearText) // <span class="stringliteral">"."</span> //trim(sBufSuffix), &amp;
<a name="l02111"></a>02111           xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSnowCover )
<a name="l02112"></a>02112       call <a class="code" href="namespaceswb__grid.html#af1f4ad8065d88804760ea3d28fb2e02">grid_WriteSurferGrid</a>(trim(sBufOut) // <span class="stringliteral">"_soil_water_cap"</span> // &amp;
<a name="l02113"></a>02113         trim(sYearText) // <span class="stringliteral">"."</span> //trim(sBufSuffix), &amp;
<a name="l02114"></a>02114           xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSoilWaterCap )
<a name="l02115"></a>02115 
<a name="l02116"></a>02116     <span class="keyword">else</span> <span class="keyword">if</span> ( sMonthName(1:3) == <span class="stringliteral">'day'</span> ) <span class="keyword">then</span>
<a name="l02117"></a>02117 
<a name="l02118"></a>02118 <span class="comment">!      call grid_WriteSurferGrid("output\\recharge." // sMonthName(4:6), &amp;</span>
<a name="l02119"></a>02119 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rDailyRecharge )</span>
<a name="l02120"></a>02120 
<a name="l02121"></a>02121 <span class="comment">!        call grid_WriteSurferGrid("output\\daily\\pot_et." // sMonthName(4:6), &amp;</span>
<a name="l02122"></a>02122 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSM_PotentialET )</span>
<a name="l02123"></a>02123 <span class="comment">!        call grid_WriteSurferGrid("output\\act_et." // sMonthName(4:6), &amp;</span>
<a name="l02124"></a>02124 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSM_ActualET )</span>
<a name="l02125"></a>02125 <span class="comment">!        call grid_WriteSurferGrid("output\\net_infil." // sMonthName(4:6), &amp;</span>
<a name="l02126"></a>02126 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rNetInfil )</span>
<a name="l02127"></a>02127 <span class="comment">!        call grid_WriteSurferGrid("output\\daily\\inflow." // sMonthName(4:6), &amp;</span>
<a name="l02128"></a>02128 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rInFlow )</span>
<a name="l02129"></a>02129 <span class="comment">!        call grid_WriteSurferGrid("output\\daily\\outflow." // sMonthName(4:6), &amp;</span>
<a name="l02130"></a>02130 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rOutFlow )</span>
<a name="l02131"></a>02131 
<a name="l02132"></a>02132 <span class="comment">!        call grid_WriteSurferGrid("output\\daily\\soil_mois." // sMonthName(4:6), &amp;</span>
<a name="l02133"></a>02133 <span class="comment">!            xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSoilMoisture )</span>
<a name="l02134"></a>02134 <span class="comment">!        call grid_WriteSurferGrid("output\\daily\\curve_num." // sMonthName(4:6), &amp;</span>
<a name="l02135"></a>02135 <span class="comment">!            xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rAdjCN )</span>
<a name="l02136"></a>02136 <span class="comment">!        call grid_WriteSurferGrid("output\\daily\\snow_cov." // sMonthName(4:6), &amp;</span>
<a name="l02137"></a>02137 <span class="comment">!            xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSnowCover )</span>
<a name="l02138"></a>02138 
<a name="l02139"></a>02139     <span class="keyword">else</span>
<a name="l02140"></a>02140 <span class="comment">!      call grid_WriteSurferGrid(trim(sBufOut) // "_rch." // trim(sBufSuffix), &amp;</span>
<a name="l02141"></a>02141 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rMonthlyRecharge )</span>
<a name="l02142"></a>02142 <span class="comment">!      call grid_WriteSurferGrid(trim(sBufOut) // "_pot_et." // trim(sBufSuffix), &amp;</span>
<a name="l02143"></a>02143 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rMonthlyPotET )</span>
<a name="l02144"></a>02144 <span class="comment">!      call grid_WriteSurferGrid(trim(sBufOut) // "_act_et." // trim(sBufSuffix), &amp;</span>
<a name="l02145"></a>02145 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rMonthlyActET )</span>
<a name="l02146"></a>02146 <span class="comment">!      call grid_WriteSurferGrid(trim(sBufOut) // "_inflow." // trim(sBufSuffix), &amp;</span>
<a name="l02147"></a>02147 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rMonthlyInFlow )</span>
<a name="l02148"></a>02148 <span class="comment">!      call grid_WriteSurferGrid(trim(sBufOut) // "_outflow." // trim(sBufSuffix), &amp;</span>
<a name="l02149"></a>02149 <span class="comment">!          xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rMonthlyOutFlow )</span>
<a name="l02150"></a>02150 <span class="comment">!        call grid_WriteSurferGrid(trim(sBufOut) // "_sm." // trim(sBufSuffix), &amp;</span>
<a name="l02151"></a>02151 <span class="comment">!            xmin,xmax,ymin,ymax,pGrd%Cells(:,:)%rSoilMoisture )</span>
<a name="l02152"></a>02152     <span class="keyword">end if</span>
<a name="l02153"></a>02153   <span class="keyword">else</span>
<a name="l02154"></a>02154     call Assert( .false._T_LOGICAL, <span class="stringliteral">"Illegal output format specified"</span> )
<a name="l02155"></a>02155   <span class="keyword">end if</span>
<a name="l02156"></a>02156 
<a name="l02157"></a>02157   return
<a name="l02158"></a>02158 <span class="keyword">end</span> <span class="keyword">subroutine </span>gavg_WriteGrids
<a name="l02159"></a>02159 
<a name="l02160"></a>02160 <span class="keyword">end module gavg</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Mar 19 14:35:55 2010 for swb by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
